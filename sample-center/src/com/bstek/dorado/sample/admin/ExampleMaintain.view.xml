<?xml version="1.0" encoding="UTF-8"?>
<ViewConfig template="com.bstek.dorado.sample.admin.AdminViewTemplate">
  <Arguments>
    <Argument name="caption">
      <Property name="value">示例结构维护</Property>
    </Argument>
  </Arguments>
  <Context/>
  <Model>
    <DataType name="CategoryNode" parent="ExampleCategory">
      <Reference name="categories" dataProvider="exampleMaintain#getCategories" dataType="[CategoryNode]" parameter="$${this.id}"/>
      <Reference name="examples" dataProvider="exampleMaintain#getExamplesByCategoryId" dataType="[ExampleNode]" parameter="$${this.id}"/>
    </DataType>
    <DataType name="ExampleNode" parent="Example">
      <PropertyDef name="sortFlag" dataType="int"/>
      <PropertyDef name="sources" dataType="[ExampleSource]"/>
    </DataType>
    <DataType name="ExampleSource" parent="global:ExampleSource"/>
  </Model>
  <View title="${argument.caption}">
    <GroupStart id="mainContent"/>
    <DataSet id="dsCategories" dataProvider="exampleMaintain#getCategories" dataType="[CategoryNode]">
      <Property name="loadMode">onReady</Property>
    </DataSet>
    <Action id="actionAddCategory" caption="添加新分类" icon=">images/folder.gif"/>
    <Action id="actionAddExample" caption="添加新示例" disabled="true" icon=">images/file.gif" tags="onCurrentNode"/>
    <Action id="actionLinkExample" caption="关联到其它分类" disabled="true" icon="url(>skin>common/icons.gif) -220px -180px" tags="onCurrentExample"/>
    <Action id="actionRemove" caption="删除" disabled="true" icon="url(>skin>common/icons.gif) -141px 0" tags="onCurrentNode">
      <Property name="confirmMessage">确认要删除当前(分类或示例)吗？</Property>
    </Action>
    <Action id="actionCancel" caption="取消" disabled="true" icon="url(>skin>common/icons.gif) -280px -220px" tags="onDirtyNode"/>
    <UpdateAction id="actionSave" caption="全部保存" dataResolver="exampleMaintain#saveAll" disabled="true" icon="url(>skin>common/icons.gif) -140px -20px" tags="onDirty">
      <Property name="successMessage">数据保存成功。</Property>
      <Property name="hotkey">ctrl+s</Property>
      <UpdateItem dataSet="dsCategories">
        <Property name="dataPath">!DIRTY_TREE</Property>
      </UpdateItem>
    </UpdateAction>
    <Menu id="menuTree">
      <MenuItem action="actionAddCategory"/>
      <MenuItem action="actionAddExample"/>
      <MenuItem action="actionLinkExample"/>
      <Separator/>
      <MenuItem action="actionRemove"/>
    </Menu>
    <ToolBar layoutConstraint="top">
      <ToolBarButton action="actionAddCategory"/>
      <ToolBarButton action="actionAddExample"/>
      <Separator/>
      <ToolBarButton action="actionLinkExample"/>
      <Separator/>
      <ToolBarButton action="actionRemove"/>
      <ToolBarButton action="actionCancel"/>
      <Separator/>
      <ToolBarButton action="actionSave"/>
      <HtmlContainer/>
      <HtmlContainer/>
    </ToolBar>
    <SplitPanel position="260">
      <MainControl>
        <CardBook id="cardbook">
          <Property name="currentIndex">2</Property>
          <Panel layout="anchor">
            <Children>
              <Label layoutConstraint="left:50%; top:50%" style="whiteSpace:noWrap" text="请在左侧树中选择一个节点..."/>
            </Children>
          </Panel>
          <Panel layout="padding:16">
            <Children>
              <AutoForm cols="*" dataPath="!CURRENT_CATEGORY" dataSet="dsCategories">
                <AutoFormElement property="label" width="350"/>
                <AutoFormElement property="new" type="checkBox" width="350"/>
                <AutoFormElement property="hot" type="checkBox" width="350"/>
                <AutoFormElement property="icon" width="350"/>
                <AutoFormElement property="url"/>
                <AutoFormElement property="tags"/>
                <AutoFormElement property="summary" type="textArea"/>
              </AutoForm>
            </Children>
          </Panel>
          <Panel layout="regionPadding:16" contentOverflow="hidden">
            <Children>
              <AutoForm dataPath="!CURRENT_EXAMPLE" dataSet="dsCategories" layoutConstraint="top">
                <Property name="cols">*,*</Property>
                <AutoFormElement property="label" width="350"/>
                <AutoFormElement property="author" width="350"/>
                <AutoFormElement property="createDate" width="350"/>
                <AutoFormElement property="lastModify" width="350"/>
                <AutoFormElement property="new" type="checkBox" width="350"/>
                <AutoFormElement property="hot" type="checkBox" width="350"/>
                <AutoFormElement property="icon" width="350"/>
                <AutoFormElement type="checkBox" width="350">
                  <Property name="property">embedded</Property>
                </AutoFormElement>
                <AutoFormElement width="350">
                  <Property name="property">embedWidth</Property>
                </AutoFormElement>
                <AutoFormElement width="350">
                  <Property name="property">embedHeight</Property>
                </AutoFormElement>
                <AutoFormElement layoutConstraint="colSpan:2" property="url"/>
                <AutoFormElement layoutConstraint="colSpan:2" property="tags"/>
                <AutoFormElement layoutConstraint="colSpan:2" property="summary" type="textArea"/>
              </AutoForm>
              <Panel caption="源文件" collapseable="true">
                <Children>
                  <ToolBar layoutConstraint="top">
                    <DataPilot dataPath="!CURRENT_EXAMPLE.sources" dataSet="dsCategories" itemCodes="+,-,x"/>
                  </ToolBar>
                  <ListDropDown id="triggerSourceLabel">
                    <Property name="items">&lt;输入源文件名称>,视图配置文件,JavaScript控制器,数据模型配置文件,视图拦截器Bean,公用拦截器Bean,页面模板文件</Property>
                  </ListDropDown>
                  <DataGrid dataPath="!CURRENT_EXAMPLE.sources" dataSet="dsCategories" dragTags="sourceEntity" draggable="true" droppable="true" droppableTags="sourceEntity" style="border:none">
                    <IndicatorColumn/>
                    <DataColumn property="label" trigger="triggerSourceLabel" width="180"/>
                    <DataColumn property="path" width="*"/>
                    <DataColumn property="summary" width="350" wrappable="true"/>
                  </DataGrid>
                </Children>
              </Panel>
            </Children>
          </Panel>
        </CardBook>
      </MainControl>
      <SideControl>
        <DataTree id="treeExamples" allowNoCurrent="true" currentNodeDataPath="CURRENT_NODE" dataSet="dsCategories" dragTags="node" draggable="true" dropMode="onOrInsertItems" droppable="true" droppableTags="node">
          <BindingConfigs>
            <BindingConfig childrenProperty="categories" icon=">images/folder.gif" labelProperty="label" name="Category" recursive="true">
              <BindingConfig childrenProperty="examples" icon=">images/file.gif" labelProperty="label" name="Example"/>
            </BindingConfig>
          </BindingConfigs>
        </DataTree>
      </SideControl>
    </SplitPanel>
    <Dialog id="dialogSelectExample" layout="padding:4" buttonAlign="right" caption="请选择一个分类..." center="true" height="400" modal="true" width="400">
      <Buttons>
        <Button id="buttonOk" caption="确定" width="80"/>
        <Button id="buttonCancel" caption="取消" width="60"/>
      </Buttons>
      <Children>
        <DataTree id="treeCategories" dataSet="dsCategories">
          <BindingConfigs>
            <BindingConfig childrenProperty="categories" icon=">images/folder.gif" labelProperty="label" name="Category" recursive="true"/>
          </BindingConfigs>
        </DataTree>
      </Children>
    </Dialog>
    <GroupEnd/>
  </View>
</ViewConfig>
