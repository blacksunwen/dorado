<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Strict//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!-- saved from url=(0040)http://cubiq.org/dropbox/clickdelay.html -->
<html id="aeaoofnhgocdbnbeljkmbjdmhbcokfdb-mousedown">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Click delay on webkit for iPhone/iPod touch</title>
<script type="text/javascript">

/**
 * 
 * NoClickDelay
 * http://cubiq.org/
 * 
 */
function NoClickDelay(el) {
	this.element = el;
	if( "ontouchstart" in window ) this.element.addEventListener('touchstart', this, false);
}

NoClickDelay.prototype = {
	handleEvent: function(e) {
		switch(e.type) {
			case 'touchstart': this.onTouchStart(e); break;
			case 'touchmove': this.onTouchMove(e); break;
			case 'touchend': this.onTouchEnd(e); break;
		}
	},
	
	onTouchStart: function(e) {
		e.preventDefault();
		this.moved = false;
		
		this.element.addEventListener('touchmove', this, false);
		this.element.addEventListener('touchend', this, false);
	},
	
	onTouchMove: function(e) {
		this.moved = true;
	},
	
	onTouchEnd: function(e) {
		this.element.removeEventListener('touchmove', this, false);
		this.element.removeEventListener('touchend', this, false);

		if( !this.moved ) {
			var theTarget = document.elementFromPoint(e.changedTouches[0].clientX, e.changedTouches[0].clientY);
			if(theTarget.nodeType == 3) theTarget = theTarget.parentNode;

			var theEvent = document.createEvent('MouseEvents');
			theEvent.initEvent('click', true, true);
			theTarget.dispatchEvent(theEvent);
		}
	}
};

function loaded() {
	var theClick = document.getElementById('theClick');
	var theTap = document.getElementById('theTap');
	var result = document.getElementById('result');

	new NoClickDelay(theTap);

	/*  Benchmarking */
	theClick.addEventListener('touchstart', function(e){
		this.timeStart = e.timeStamp;
	}, false);
	
	theClick.addEventListener('click', function(e){
		result.innerHTML = 'Delay: ' + (e.timeStamp-this.timeStart) + 'ms';
	}, false);

	theTap.addEventListener('touchstart', function(e){
		this.timeStart = e.timeStamp;
	}, false);
	
	theTap.addEventListener('click', function(e){
		result.innerHTML = 'Delay: ' + (e.timeStamp-this.timeStart) + 'ms';
	}, false);
}

window.addEventListener('load', function(){ setTimeout(function(){ loaded(); }, 100) }, true);

</script>

<style type="text/css" media="all">

button {
	width:290px;
	font-size:18px;
	margin-bottom:10px;
}

#result {
	padding:10px;
	background:#ddd;
	-webkit-border-radius:8px;
	margin:10px;
	text-align:center;
	background:#bdf;
}

</style>

</head>

<body>
<p>Please note that this example works only on iPhone, iPod touch and the simulator, not on any browser.</p>

<div style="text-align:center">
<button id="theClick">onClick event</button>
<button id="theTap">touchStart/End events</button>
</div>
	
<div id="result">Tap on the buttons above</div>

<p>The first button triggers the standard <em>onClick</em> event with about 300ms delay.</p>
<p>The second button ovverrides the <em>onClick</em> event, the "click" is triggered on touchEnd thus eliminating the 300ms delay.</p>
<p><a href="http://cubiq.org/remove-onclick-delay-on-webkit-for-iphone/9">Read more about this on cubiq.org</a></p>

</body>
</html>