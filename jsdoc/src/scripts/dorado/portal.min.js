dorado.widget.Portlet=$extend(dorado.widget.Panel,{ATTRIBUTES:{showCaptionBar:{defaultValue:true},border:{defaultValue:"curve"},column:{defaultValue:0}},createDom:function(){var b=this,a=$invokeSuper.call(this,arguments);$DomUtils.disableUserSelection(b._doms.captionBar);$fly(a).draggable({addClasses:false,handle:".d-caption-bar",scope:"portal",cursor:"move",distance:10,tolerance:"pointer",helper:"clone",start:function(){if(dorado.Browser.chrome){$DomUtils.disableUserSelection(document.body)}b._parent._draggingPortlet=b;$fly(a).css("display","none")},drag:function(){var c=b._parent,u=c._dropColumnIndex,e=c._columnDoms;if(u>=0){var q=c._columns.get(u),d=e[u],n=c._columnPortlets[u],m=100000,k=null,p,h=c._placeholder,g=jQuery.data(this,"draggable");if(!n){n=c._columnPortlets[u]=[]}if(h){var w={offset:$fly(h).offset(),proportions:{width:$fly(h).width(),height:$fly(h).height()}};if(jQuery.ui.intersect(g,w,"touch")&&h.parentNode==d){return}}for(var s=0,r=n.length;s<r;s++){var t=n[s];if(t._dom!=this){var v={offset:$fly(t._dom).offset(),proportions:{width:$fly(t._dom).width(),height:$fly(t._dom).height()}},l=jQuery.ui.intersect(g,v,"touch");
if(l){var f=Math.sqrt(Math.pow((g.positionAbs.left+g.helperProportions.width/2)-(v.offset.left+v.proportions.width/2),2)+Math.pow((g.positionAbs.top+g.helperProportions.height/2)-(v.offset.top+v.proportions.height/2),2));if(f<m){k=s;p=t._dom;m=f}}}}var o;if(k!=null&&k>=0){c._setPlaceHolderPosition(u,k);o=$fly(p).width();$fly(c._placeholder).outerWidth(o);$fly(c._placeholder).outerHeight(g.helperProportions.height)}else{c._setPlaceHolderPosition(u);o=$fly(d).width();$fly(c._placeholder).outerWidth(o);$fly(c._placeholder).outerHeight(g.helperProportions.height)}}},stop:function(){if(dorado.Browser.chrome){$DomUtils.enableUserSelection(document.body)}$fly(a).css("display","");var c=b._parent;c._draggingPortlet=null;if(c._placeholder){$fly(c._placeholder).css("display","none")}}});return a}});dorado.widget.PortalColumn=function(a){a=a||{};this.name=a.name;this.width=a.width||"*";this.className=a.className};dorado.widget.Portal=$extend(dorado.widget.Control,{ATTRIBUTES:{className:{defaultValue:"d-portal"},portlets:{writeOnly:true,setter:function(a,e){if(e instanceof Array){this._columnPortlets=[];
for(var c=0,b=e.length;c<b;c++){var f=e[c];if(!(f instanceof dorado.widget.Portlet)){f=new dorado.widget.Portlet(f)}var d=f._column||0;var g=this._columnPortlets[d];if(!g){g=this._columnPortlets[d]=[]}g.push(f)}}}},columnPortlets:{},columns:{setter:function(m,p){var n=this,a=n._columns,s;if(p instanceof Array){s=new dorado.util.KeyedArray(function(i){return i.name});for(var k=0,g=p.length;k<g;k++){var d=p[k];if(!(d instanceof dorado.widget.PortalColumn)){d=new dorado.widget.PortalColumn(d)}s.append(d)}}if(a){var h=a.size,e=s.size,b=n._rendered;for(var k=e;k<h;k++){var r=n._columnPortlets[k];if(r){for(var g=0,c=r.length;g<c;g++){var q=r[g];n._columnPortlets[0].push(q);if(b){n._columnDoms[0].appendChild(q._dom)}}r.removeAt(k)}if(b){$fly(n._columnDoms[k]).css("display","none")}}var f=n._dom;for(var k=h;k<e;k++){if(b){var o=n._columnDoms[k];if(!o){o=n._columnDoms[k]=n._createColumn(k);f.appendChild(o)}else{$fly(o).css("display","")}}}}if(p==null){}n._columns=s}},portletPadding:{defaultValue:10}},insertPortlet:function(j,c,e){var h=this,d=h._columns,f=c,b=h._columnDoms;
if(!j||!d){return}var a=d.get(c),i=b[c];if(d){if(typeof c=="string"){f=d.indexOf(a)}var k=h._columnPortlets[f];if(!k){k=h._columnPortlets[f]=[]}if(typeof e=="number"&&e>=0){if(i){var g=k[e];j.render(i,(g||{})._dom);$fly(j._dom).css("margin-bottom",h._portletPadding);j._column=f;h.registerInnerControl(j)}k.insert(j,e)}else{if(i){j.render(i);$fly(j._dom).css("margin-bottom",h._portletPadding);j._column=f;h.registerInnerControl(j)}k.push(j)}}},appendPortlet:function(b,a){this.insertPortlet(b,a)},removePortlet:function(f,e){var a=this,c=a._columns,d=e;if(!f||!c){return}var b=c.get(e);if(c){if(typeof e=="string"){d=c.indexOf(b)}a.unregisterInnerControl(f);var g=a._columnPortlets[d];if(g){g.remove(f);f.destroy()}}},clearPortlets:function(){var a=this,b=a._columnPortlets;for(var d=0;d<b.length;d++){var f=b[d];if(!f){continue}for(var c=0;c<f.length;c++){var e=f[c];e.destroy()}}a._columnPortlets=[]},_setPlaceHolderPosition:function(b,j){var d=this,g=d._placeholder;if(!g){g=d._placeholder=document.createElement("div");
g.className="place-holder";$fly(g).css("margin-bottom",d._portletPadding)}g.style.display="";if(b==d._placeholderColumn&&j==d._placeholderRow){return}d._placeholderColumn=b;d._placeholderRow=j;var a=d._columns.get(b),f=d._columnDoms[b];if(j==null||j==undefined){f.appendChild(g);d._placeholderColumn=b;d._placeholderRow=j}else{var i=d._columnPortlets[b];if(i){var h=i[j];if(h._dom){try{f.insertBefore(g,h._dom)}catch(c){}}else{f.appendChild(g)}}}},_createColumn:function(c){var a=this,d=a._columnDoms,b=d[c]=$DomUtils.xCreateElement({tagName:"div",className:"portal-column"});b.index=c;$fly(b).droppable({hoverClass:"portal-column-hover",scope:"portal",greedy:false,drop:function(f,g){var e=a._placeholderColumn,h=a._placeholderRow;if(e==null){return}var i=a._columnPortlets[e];if(!i){i=a._columnPortlets[e]=[]}if(h==null){h=i.length;this.appendChild(a._draggingPortlet._dom)}else{this.insertBefore(a._draggingPortlet._dom,i[h]._dom)}i.insert(a._draggingPortlet,h);if(a._columnPortlets[a._draggingPortlet._column]){a._columnPortlets[a._draggingPortlet._column].remove(a._draggingPortlet)
}a._draggingPortlet.set("width",$fly(this).width());a._draggingPortlet._column=e;if(dorado.Browser.msie){a._dom.appendChild(a._placeholder)}a._placeholder.style.display="none"},over:function(e,f){a._dropColumnIndex=this.index},out:function(e,f){}});return b},createDom:function(){var m=this,f=$DomUtils.xCreateElement({tagName:"div",className:m._className,style:{padding:m._portletPadding+"px"}}),a;a=m._columnDoms=[];var c=m._columns;if(c){for(var g=0;g<c.size;g++){var n=m._createColumn(g);$fly(f).append(n)}var h=m._columnPortlets;if(h){for(var g=0,d=h.length;g<d;g++){var p=h[g];if(!p){continue}var n=a[g];for(var e=0,b=p.length;e<b;e++){var o=p[e];o.render(n);o._column=g;$fly(o._dom).css("margin-bottom",m._portletPadding);m.registerInnerControl(o)}}}}return f},refreshDom:function(w){$invokeSuper.call(this,arguments);var c=this,b=c._columns,e=c._columnDoms;if(b){var x=c._columnPortlets,p=$fly(w).width(),m=$fly(w).height(),z=b.size,r=p-(z-1)*c._portletPadding;var a=[],g=0,o=[];for(var v=0;v<z;
v++){var u=b.get(v),h=u.width||"*";if(h=="*"){a.push(v)}else{var n;if(String(h).indexOf("%")!=-1){n=r*parseInt(h,10)/100}else{n=parseInt(h,10)}g+=n;o[v]=n}}var A=r-g,t=a.length,j=A/t;for(var v=0;v<t;v++){o[a[v]]=j}for(var v=0;v<z;v++){var d=e[v],h=o[v];$fly(d).width(h).outerHeight(m).css("padding-right",v!=z-1?c._portletPadding:0);var f=x[v];if(!f){continue}for(var s=0,q=f.length;s<q;s++){var y=f[s];y.set("width",h)}}}}});