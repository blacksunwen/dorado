(function(){dorado.widget.blockview={};dorado.widget.blockview.BlockItemModel=$extend(dorado.widget.list.ItemModel,{_lineSize:1,setLineSize:function(a){this._lineSize=a},getLineCount:function(){return parseInt((this.getItemCount()-1)/this._lineSize+1)},setScrollPos:function(c){var b=this.getItemCount(),a=this.getLineCount();if(a>0){this._startIndex=parseInt(((c/this._scrollSize)||0)*a)*this._lineSize}else{this._startIndex=0}}});dorado.widget.blockview.DefaultBlockRenderer=$extend(dorado.Renderer,{render:function(c,a){var b=a.data;c.innerText=c.itemIndex+": "+b}});dorado.widget.blockview.ImageBlockRenderer=$extend(dorado.widget.blockview.DefaultBlockRenderer,{captionProperty:"caption",imageProperty:"image",tipProperty:"tip",blankImage:">skin>block/blank-image.png",padding:2,spacing:2,labelHeight:17,stretchImage:false,constructor:function(a){dorado.Object.apply(this,a)},getImageDom:function(b){var a=b.firstChild;if(a==null){a=$DomUtils.xCreateElement({tagName:"IMG",style:{position:"absolute"}});
b.appendChild(a)}return a},getLabelDom:function(b){var a=b.lastChild;if(a==null||a.nodeName!="CENTER"){a=$DomUtils.xCreateElement({tagName:"CENTER",style:{position:"absolute"},content:"^LABEL"});b.appendChild(a)}return a},render:function(c,l){var a=this.getImageDom(c),e=l.data;var d=0;if(this.captionProperty&&this.labelHeight>0){d=this.labelHeight;var j=this.getLabelDom(c);var f=(e instanceof dorado.Entity)?e.get(this.captionProperty):e[this.captionProperty];$fly(j).css({bottom:this.padding,width:c.clientWidth-this.padding*2,height:d});j.firstChild.innerText=f}if(this.tipProperty){var g=(e instanceof dorado.Entity)?e.get(this.tipProperty):e[this.tipProperty];if(g){dorado.TipManager.initTip(c,{text:g})}else{dorado.TipManager.deleteTip(c)}}var k=this;var i=c.clientWidth-this.padding*2;var h=c.clientHeight-d-this.spacing-this.padding*2;if(this.stretchImage){$fly(a).css({left:this.padding,top:this.padding,width:i,height:h})}else{$fly(a).bind("load",function(){var p,o,n=a.offsetWidth,m=a.offsetHeight;
if(n>i){m=Math.round(i*m/n);n=i}if(m>h){n=parseInt(h*n/m);m=h}p=Math.round((c.clientWidth-n)/2);o=Math.round((c.clientHeight-d-k.spacing-m)/2);$fly(a).css({left:p,top:o,width:n,height:m})})}var b=(e instanceof dorado.Entity)?e.get(this.imageProperty):e[this.imageProperty];$DomUtils.setImgSrc(a,b||this.blankImage)}});dorado.widget.AbstractBlockView=$extend(dorado.widget.ViewPortList,{$className:"dorado.widget.AbstractBlockView",ATTRIBUTES:{className:{defaultValue:"d-block-view"},blockLayout:{defaultValue:"vertical"},lineSize:{},blockWidth:{defaultValue:80},blockHeight:{defaultValue:80},fillLine:{},renderer:{},horiSpacing:{defaultValue:8},vertSpacing:{defaultValue:8},horiPadding:{defaultValue:8},vertPadding:{defaultValue:8},blockDecoratorSize:{defaultValue:4}},EVENTS:{onRenderBlock:{},onBlockMouseDown:{},onBlockMouseUp:{},onBlockClick:{},onBlockDoubleClick:{}},createItemModel:function(){return new dorado.widget.blockview.BlockItemModel()},createDom:function(){var b=$invokeSuper.call(this,arguments);
var a=this._container=$DomUtils.xCreateElement({tagName:"DIV",style:{position:"relative",overflow:"hidden"}});b.appendChild(a);$fly(b).bind("scroll",$scopify(this,this.onScroll)).mouseover($scopify(this,function(c){if($DomUtils.isDragging()){return}var d=$DomUtils.findParent(c.target,function(e){return e.parentNode==a&&$fly(e).hasClass("block")});this.setHoverBlock(d)})).mouseleave($scopify(this,function(c){this.setHoverBlock(null)}));return b},refreshDom:function(c){$invokeSuper.call(this,arguments);var g=this._lineSize,e=this._blockWidth,a=this._blockHeight;if(this._blockLayout=="vertical"){if(!(g>0)){g=(c.clientWidth-this._horiPadding*2)/(this._blockWidth+this._horiSpacing/2)}}else{if(!(g>0)){g=(c.clientHeight-this._vertPadding*2)/(this._blockHeight+this._vertSpacing/2)}}this._realLineSize=g=(g<1)?1:parseInt(g);this._itemModel.setLineSize(g);this._lineCount=this._itemModel.getLineCount();var b,i,j=jQuery(this._container);if(this._blockLayout=="vertical"){c.style.overflowX="hidden";c.style.overflowY="auto"
}else{c.style.overflowX="auto";c.style.overflowY="hidden"}var f=this._getContainerSize();if(this._blockLayout=="vertical"){j.height(f[1]).width(c.clientWidth);if(this._lineSize>0&&this._fillLine){e=(c.clientWidth-this._horiPadding*2-this._horiSpacing*(g-1))/g}}else{j.width(f[0]).height(c.clientHeight);if(this._lineSize>0&&this._fillLine){a=(c.clientHeight-this._vertPadding*2-this._vertSpacing*(g-1))/g}}this._realBlockWidth=e=(e<1)?1:parseInt(e);this._realBlockHeight=a=(a<1)?1:parseInt(a);var h=this._container.firstChild;while(h){var d=h.nextSibling;if(h._isBlock){this.removeItemDom(h)}h=d}if(this._scrollMode=="viewport"){this.refreshViewPortContent(this._container)}else{this.refreshContent(this._container)}},_getVisibleBlockRange:function(){var a=this._dom,c,b;if(this._blockLayout=="vertical"){c=this._blockHeight+this._vertSpacing;start=parseInt((a.scrollTop-this._vertPadding)/c);b=start+Math.round((a.clientHeight-this._vertPadding)/c+0.5)}else{c=this._blockWidth+this._horiSpacing;start=parseInt((a.scrollLeft-this._horiPadding)/c);
b=start+Math.round((a.clientWidth-this._horiPadding)/c+0.5)}return[start*this._realLineSize,b*this._realLineSize]},refreshContent:function(a){var c;if(this._scrollMode=="lazyRender"){var d=this._getVisibleBlockRange()[1],b=0;c=function(e){b++;return b<d}}this.refreshItemDoms(a,false,c);this._itemDomCount=this._itemModel.getItemCount()},refreshViewPortContent:function(b){var e=this._itemModel,h=e.getItemCount(),a=this._dom;var d,f;if(this._blockLayout=="vertical"){d=a.scrollTop;f=a.scrollTop+a.clientHeight}else{d=a.scrollLeft;f=a.scrollLeft+a.clientWidth}var g,c=this;if(f>d){g=this.refreshItemDoms(b,e.isReverse(),function(i){if(i.subIndex==c._realLineSize-1){return((c._blockLayout=="vertical")?(i.offsetTop+i.offsetHeight+c._vertSpacing):(i.offsetLeft+i.offsetWidth+c._horiSpacing))<f}return true},true)}else{g=viewPortHeight=0}this._itemDomCount=g;if(this._blockLayout=="vertical"){e.setScrollSize(this._dom.clientHeight,b.clientHeight)}else{e.setScrollSize(this._dom.clientWidth,b.clientWidth)
}},refreshItemDoms:function(c){var a=this._currentDecorator,e=this._hoverDecorator;if(a){c.removeChild(a.getDom())}if(e){c.removeChild(e.getDom())}$invokeSuper.call(this,arguments);if(a){c.insertBefore(a.getDom(),c.firstChild)}if(e){c.insertBefore(e.getDom(),c.firstChild)}var d=this.getCurrentItemId();if(d){var b=this._itemDomMap[d];if(b){this.setCurrentBlock(b)}}},_getBlockPos:function(b){var e=parseInt(b/this._realLineSize);var a=b%this._realLineSize;var d,c;if(this._blockLayout=="vertical"){d=this._horiPadding+(this._realBlockWidth+this._horiSpacing)*a;c=this._vertPadding+(this._realBlockHeight+this._vertSpacing)*e}else{d=this._horiPadding+(this._realBlockWidth+this._horiSpacing)*e;c=this._vertPadding+(this._realBlockHeight+this._vertSpacing)*a}return[d,c,e,a]},removeItemDom:function(a){$invokeSuper.call(this,arguments);this._itemDomCount--;this._lineCount=parseInt(this._itemDomCount/this._realLineSize)},refreshItemDom:function(h,i,b,j){var e=j?-1:1;if(b<0){e=-e}b=(this._itemModel.getStartIndex()||0)+b*e;
var g=this._itemModel.getItemId(i,b);var d=this._itemDomMap[g];if(!d){d=this.createItemDom(i);h.appendChild(d);this._itemDomMap[g]=d;d.itemId=g}d.itemIndex=b;var f=this._getBlockPos(b);d.lineIndex=f[2];d.subIndex=f[3];$fly(d).data("item",i).css({left:f[0],top:f[1]}).outerWidth(this._realBlockWidth).outerHeight(this._realBlockHeight);this._itemDomCount++;this._lineCount=parseInt(this._itemDomCount/this._realLineSize);var c=true;var a={dom:d,data:i,processDefault:false};if(this.getListenerCount("onRenderBlock")&&this.fireEvent("onRenderBlock",this,a)){c=a.processDefault}if(c){this.refreshItemDomData(d,i)}return d},createItemDom:function(a){var b=$DomUtils.xCreateElement({tagName:"DIV",className:"block",style:{position:"absolute",overflow:"hidden"}});b._isBlock=true;if(this._scrollMode=="lazyRender"&&this._shouldSkipRender){b._lazyRender=true}return b},createItemDomDetail:dorado._NULL_FUNCTION,refreshItemDomData:function(c,a){if(c._lazyRender){return}var b=(a instanceof dorado.Entity)?a.timestamp:-1;
if(this._ignoreItemTimestamp||b<=0||c.timestamp!=b){(this._renderer||$singleton(dorado.widget.blockview.DefaultBlockRenderer)).render(c,{blockView:this,data:a});c.timestamp=b}},getHoverBlockDecorator:function(){var a=this._hoverDecorator;if(!a){this._hoverDecorator=a=new dorado.widget.Panel({className:"block-decorator",border:"curve"});a.render(this._container);this.registerInnerControl(a)}return a},setHoverBlock:function(b){if(b){if(this._draggable&&this._dragMode!="control"){this.applyDraggable(b)}$fly(b).addClass("block-hover")}if(this._hoverBlock==b){return}if(this._hoverBlock){$fly(this._hoverBlock).removeClass("block-hover")}this._hoverBlock=b;var a=this.getHoverBlockDecorator();if(b&&this._currentBlock!=b){a.set({width:b.offsetWidth+this._blockDecoratorSize*2,height:b.offsetHeight+this._blockDecoratorSize*2,style:{left:b.offsetLeft-this._blockDecoratorSize,top:b.offsetTop-this._blockDecoratorSize,display:""}})}else{a.set("style",{display:"none"})}a.refresh()},getCurrentBlockDecorator:function(){var a=this._currentDecorator;
if(!a){this._currentDecorator=a=new dorado.widget.Panel({className:"block-decorator",border:"curve"});$fly(a.getDom()).addClass("current-decorator");a.render(this._container);this.registerInnerControl(a)}return a},setCurrentBlock:function(b){if(this._currentBlock==b){return}if(this._currentBlock){$fly(this._currentBlock).removeClass("block-current")}this._currentBlock=b;if(b){$fly(b).addClass("block-current")}var a=this.getCurrentBlockDecorator();if(b){a.set({width:b.offsetWidth+this._blockDecoratorSize*2,height:b.offsetHeight+this._blockDecoratorSize*2,style:{left:b.offsetLeft-this._blockDecoratorSize,top:b.offsetTop-this._blockDecoratorSize,display:""}})}else{a.set("style",{display:"none"})}a.refresh()},onScroll:function(){function f(i,h){if(a[i]==(a[h]||0)){return}if(a._scrollTimerId){clearTimeout(a._scrollTimerId);a._scrollTimerId=undefined}else{a[h]=a[i]}a._scrollTimerId=$setTimeout(this,this.doOnScroll,300)}if(this._scrollMode=="viewport"){var a=this._dom;if(this._blockLayout=="vertical"){if((this._scrollTop||0)!=a.scrollTop){f.call(this,"scrollTop","_scrollTop")
}}else{if((this._scrollLeft||0)!=a.scrollLeft){f.call(this,"scrollLeft","_scrollLeft")}}this._scrollLeft=a.scrollLeft;this._scrollTop=a.scrollTop}else{if(this._scrollMode=="lazyRender"){var b=this._getVisibleBlockRange(),g=this._container.childNodes;for(var c=b[0];c<=b[1]&&c<g.length;c++){var e=g[c];if(e._lazyRender){var d=$fly(e).data("item");this.createItemDomDetail(e,d);delete e._lazyRender;this.refreshItemDomData(e,d)}}}}},doOnScroll:function(){var a=this._dom;if(a._scrollTimerId){clearTimeout(a._scrollTimerId);a._scrollTimerId=undefined}this._itemModel.setScrollPos((this._blockLayout=="vertical")?a.scrollTop:a.scrollLeft);this.refreshViewPortContent(this._container)},_findBlockDom:function(b){var a=this._container;return $DomUtils.findParent(b.target,function(c){return c.parentNode==a})},onMouseDown:function(a){var c=this._findBlockDom(a);if(c||this._allowNoCurrent){var b=c?$fly(c).data("item"):null;this.fireEvent("onBlockMouseDown",this,{data:b});this.setCurrentItemDom(c)}},onMouseUp:function(a){var c=this._findBlockDom(a);
if(c){var b=$fly(c).data("item");if(b){this.fireEvent("onBlockMouseUp",this,{data:b})}}},onClick:function(a){var c=this._findBlockDom(a);if(c){var b=$fly(c).data("item");if(b){this.fireEvent("onBlockClick",this,{data:b})}}},onDoubleClick:function(a){var c=this._findBlockDom(a);if(c){var b=$fly(c).data("item");if(b){this.fireEvent("onBlockDoubleClick",this,{data:b})}}},scrollCurrentIntoView:function(){var d=this.getCurrentItemId();var a=this._itemDomMap[d],f=this._dom,b;if(a){b=a.itemIndex;if(b>=this.startIndex&&b<=(this.startIndex+this.itemDomCount)){if(this._blockLayout=="vertical"){if(a.offsetTop<f.scrollTop){f.scrollTop=this._scrollTop=a.offsetTop-this._vertSpacing}else{if((a.offsetTop+a.offsetHeight)>(f.scrollTop+f.clientHeight)){f.scrollTop=this._scrollTop=a.offsetTop+a.offsetHeight-f.clientHeight+this._vertSpacing}}}else{if(a.offsetLeft<f.scrollLeft){f.scrollLeft=this._scrollLeft=a.offsetLeft-this._horiSpacing}else{if((a.offsetLeft+a.offsetWidth)>(f.scrollLeft+f.clientWidth)){f.scrollLeft=this._scrollLeft=a.offsetLeft+a.offsetWidth-f.clientWidth+this._horiSpacing
}}}return}}else{var c=this.getCurrentItem();if(c){b=this._itemModel.getItemIndex(c)}}var e=parseInt(b/this._realLineSize);if(b<this.startIndex){if(this._blockLayout=="vertical"){f.scrollTop=this._scrollTop=e*(this._blockHeight+this._vertSpacing)+this._vertPadding-this._vertSpacing}else{f.scrollLeft=this._scrollLeft=e*(this._blockWidth+this._horiSpacing)+this._horiPadding-this._horiSpacing}}else{if(b>(this.startIndex+this.itemDomCount-1)){if(this._blockLayout=="vertical"){f.scrollTop=this._scrollTop=(e+1)*(this._blockHeight+this._vertSpacing)+this._vertPadding-f.clientHeight}else{f.scrollLeft=this._scrollLeft=(e+1)*(this._blockWidth+this._horiSpacing)+this._horiPadding-f.clientWidth}}}this.doOnScroll()},_getContainerSize:function(){var b=-1,g=-1,i;var h=this._itemModel.getLineCount();var c=this._dom,f=this._container,e;var d=this._blockWidth,a=this._blockHeight;if(this._blockLayout=="vertical"){e=c.scrollHeight>c.clientHeight;g=this._vertPadding*2+(a+this._vertSpacing)*h-this._vertSpacing;
i=(g>c.clientHeight)^e}else{e=c.scrollWidth>c.clientWidth;b=this._horiPadding*2+(d+this._horiSpacing)*h-this._horiSpacing;i=(b>c.clientWidth)^e}return[b,g,i]},_arrangeBlockDoms:function(e,b){var a=this._container;var c=a.firstChild;while(c){if(c.itemIndex>=e){c.itemIndex=c.itemIndex+b;var d=this._getBlockPos(c.itemIndex);$fly(c).css({left:d[0],top:d[1]})}c=c.nextSibling}},onResize:function(){if(this._lineSize&&this._fillLine){this.refresh()}else{this._arrangeBlockDoms()}},findItemDomByEvent:function(b){var c=b.srcElement||b.target;var c=c||b,a=this._container;return $DomUtils.findParent(c,function(d){return d.parentNode==a})},findItemDomByPosition:function(e){var b=this._dom,g=e.x+b.scrollLeft,f=e.y+b.scrollTop;var a=parseInt((g-this._horiPadding-this._horiSpacing/2)/(this._realBlockWidth+this._horiSpacing));var c=parseInt((f-this._vertPadding-this._vertSpacing/2)/(this._realBlockHeight+this._vertSpacing));var d=-1;if(this._blockLayout=="vertical"){if(a>this._realLineSize-1){a=this._realLineSize-1
}d=this._realLineSize*c+a}else{if(c>this._realLineSize-1){c=this._realLineSize-1}d=this._realLineSize*a+c}if(d>=0&&d<this._itemModel.getItemCount()){var j=this._itemModel,i=j.getItemAt(d);var h=this._itemDomMap[j.getItemId(i)];if(h){h._dropX=g-h.offsetLeft;h._dropY=f-h.offsetTop}return h}else{return null}},initDraggingIndicator:function(c,a,b){if(this._dragMode!="control"){var e=a.get("element");if(e){var d=$DomUtils.xCreateElement({tagName:"div",className:"d-list-dragging-item"});$fly(e).clone().css({left:0,top:0,position:"relative"}).appendTo(d);c.set("content",d)}}},setDraggingOverBlockDom:function(a){if(this._draggingOverBlockDom==a){return}if(this._draggingOverBlockDom){$fly(this._draggingOverBlockDom).removeClass("block-drag-over")}this._draggingOverBlockDom=a;if(a){$fly(a).addClass("block-drag-over")}},onDraggingSourceMove:function(h,g){var j=this._dropMode;var i=h.get("targetObject");var d,a,e;if(j!="onControl"){var f=this.getMousePosition(g);blockItem=this.findItemDomByPosition(f);
if(blockItem&&$fly(blockItem).data("item")==h.get("object")){blockItem=null}if(blockItem){if(j=="insertItems"){if(this._blockLayout=="vertical"){d=(blockItem._dropX<(this._realBlockWidth/2))?"before":"after"}else{d=(blockItem._dropY<(this._realBlockHeight/2))?"before":"after"}}else{if(j=="onOrInsertItems"){if(this._blockLayout=="vertical"){if(blockItem._dropX<4){d="before"}else{if(blockItem._dropX>(this._realBlockWidth-4)){d="after"}}}else{if(blockItem._dropY<4){d="before"}else{if(blockItem._dropY>(this._realBlockHeight-4)){d="after"}}}}}}a=blockItem?$fly(blockItem).data("item"):null;if(!a){i=(j=="onAnyWhere")?this:null}else{i=a}}var c=(h.isDropAcceptable(this._droppableTags)&&!(j=="onItem"&&i==null));h.set({targetObject:i,insertMode:d,refObject:a,accept:c});var b={draggingInfo:h,event:g,processDefault:true};this.fireEvent("onDraggingSourceMove",this,b);if(c&&b.processDefault){this.setDraggingOverBlockDom(blockItem);this.showDraggingInsertIndicator(h,d,blockItem)}return b.processDefault
},onDraggingSourceOut:function(a,b){$invokeSuper.call(this,arguments);this.setDraggingOverBlockDom();this.showDraggingInsertIndicator()},showDraggingInsertIndicator:function(a,e,h){var c=dorado.widget.blockview.getDraggingInsertIndicator(this._blockLayout);var d=$fly(c);if(e){var b=this._container;if(this._blockLayout=="vertical"){var g;if(e=="before"){g=h.offsetLeft-parseInt(this._horiSpacing/2)}else{g=h.offsetLeft+h.offsetWidth+parseInt(this._horiSpacing/2)}d.height(h.offsetHeight).left(g-1).top(h.offsetTop)}else{var f;if(e=="before"){f=h.offsetTop-parseInt(this._vertSpacing/2)}else{f=h.offsetTop+h.offsetHeight+parseInt(this._vertSpacing/2)}d.width(h.offsetWidth).top(f-1).left(h.offsetLeft)}d.show().appendTo(b)}else{d.hide().appendTo($DomUtils.getInvisibleContainer())}},onDraggingSourceDrop:function(a,b){this.showDraggingInsertIndicator();return dorado.widget.RowList.prototype.onDraggingSourceDrop.apply(this,arguments)},processItemDrop:dorado.widget.RowList.prototype.processItemDrop});
dorado.widget.blockview.getDraggingInsertIndicator=function(c){var b=(c=="horizontal")?"h":"v";var a=this["_draggingInsertIndicator-"+b];if(a==null){a=$DomUtils.xCreateElement({tagName:"div",className:"d-block-dragging-insert-indicator-"+b});this["_draggingInsertIndicator-"+b]=a}return a}})();dorado.widget.BlockView=$extend(dorado.widget.AbstractBlockView,{$className:"dorado.widget.BlockView",ATTRIBUTES:{currentIndex:{skipRefresh:true,setter:function(d,a){var b=this._itemModel;if(a>=b.getItemCount()){a=-1}if(this._currentIndex==a){return}this._currentIndex=a;if(this._rendered){var c=this.getItemDomByItemIndex(a);this.setCurrentBlock(c);this.scrollCurrentIntoView()}}},items:{setter:function(b,a){this._itemModel.setItems(a)},getter:function(){return this._itemModel.getItems()}}},refreshDom:function(a){this.set("currentIndex",this._currentIndex);$invokeSuper.call(this,arguments)},getItemDomByItemIndex:function(a){return this._itemDomMap[a]},getCurrentItem:function(){if(this._currentIndex>=0){return this._itemModel.getItemAt(this._currentIndex)
}},getCurrentItemId:function(){return this._currentIndex},setCurrentItemDom:function(a){this.set("currentIndex",a?a.itemIndex:-1);return true},doOnKeyDown:function(a){function d(){if(this._currentIndex>0){this.set("currentIndex",this._currentIndex-1)}}function b(){if(this._currentIndex<this._itemModel.getItemCount()-1){this.set("currentIndex",this._currentIndex+1)}}function e(){var g=this._currentIndex-this._realLineSize;if(g<0){g=0}this.set("currentIndex",g)}function c(){var g=this._currentIndex+this._realLineSize;if(g>=this._itemModel.getItemCount()){g=this._itemModel.getItemCount()-1}this.set("currentIndex",g)}var f=true;switch(a.keyCode||a.which){case 36:this.set("currentIndex",0);break;case 35:this.set("currentIndex",this._itemModel.getItemCount()-1);break;case 37:((this._blockLayout=="vertical")?d:e).call(this);f=false;break;case 39:((this._blockLayout=="vertical")?b:c).call(this);f=false;break;case 38:((this._blockLayout=="vertical")?e:d).call(this);f=false;break;case 40:((this._blockLayout=="vertical")?c:b).call(this);
f=false;break}return f},highlightItem:function(b,a,c){var d=this.getItemDomByItemIndex(b);if(d){$fly(d).effect("pulsate",{times:3},c||230)}}});dorado.widget.DataBlockView=$extend([dorado.widget.AbstractBlockView,dorado.widget.DataControl],{$className:"dorado.widget.DataBlockView",getCurrentItem:function(){return this._itemModel.getItems().current},getCurrentItem:function(){return this._itemModel.getItems().current},getCurrentItemId:function(b,a){var c=this._itemModel.getItems().current;return c?c.entityId:null},setCurrentItemDom:function(d){var c=$fly(d).data("item"),a=this.setCurrentEntity(c);if(a){this._itemModel.getItems().setCurrent(c)}return a},refreshEntity:function(a){var b=this._itemDomMap[a.entityId];if(b){this.refreshItemDomData(b,a)}},refreshDom:function(b){var a=this.getBindingData({firstResultOnly:true,acceptAggregation:true});if(a&&!(a instanceof dorado.EntityList)){throw new dorado.ResourceException(dorado.list.BindingTypeMismatch)}this._itemModel.setItems(a);$invokeSuper.call(this,arguments)
},setCurrentEntity:function(a){var c=a?a.entityId:null;var b=this._itemDomMap[c];this.setCurrentBlock(b);this.scrollCurrentIntoView();return true},onEntityDeleted:function(a){var b=a.entity;if(this._lineCount!=this._itemModel.getLineCount()){var f=this._getContainerSize();if(f[2]){this.refresh(true);return}else{var d=$fly(this._container);if(this._blockLayout=="vertical"){d.height(f[1])}else{d.width(f[0])}}}var c=this._itemDomMap[b.entityId];if(c){var e=c.itemIndex;this.removeItemDom(c);this._arrangeBlockDoms(e+1,-1)}},onEntityInserted:function(i){var c=i.entity;if(this._lineCount!=this._itemModel.getLineCount()){var g=this._getContainerSize();if(g[2]){this.refresh(true);return}else{var h=$fly(this._container);if(this._blockLayout=="vertical"){h.height(g[1])}else{h.width(g[0])}}}var d=i.insertMode;var b=i.refEntity;var a=this._container;switch(d){case"begin":this.refreshItemDom(a,c,0);this._arrangeBlockDoms(1,1);break;case"before":var f=this._itemDomMap[b.entityId],e=f.itemIndex;this._arrangeBlockDoms(e,1);
this.refreshItemDom(a,c,e);break;case"after":var f=this._itemDomMap[b.entityId],e=f.itemIndex;this._arrangeBlockDoms(e+1,1);this.refreshItemDom(a,c,e+1);break;default:this.refreshItemDom(a,c,this.itemCount)}},filterDataSetMessage:function(d,a){var c=this._itemModel;var b=c.getItems();switch(d){case dorado.widget.DataSet.MESSAGE_REFRESH:return true;case dorado.widget.DataSet.MESSAGE_CURRENT_CHANGED:return(a.entityList==b||dorado.DataUtil.isOwnerOf(b,a.entityList));case dorado.widget.DataSet.MESSAGE_DATA_CHANGED:case dorado.widget.DataSet.MESSAGE_REFRESH_ENTITY:return(!b||b._observer!=this._dataSet||a.entity.parent==b||dorado.DataUtil.isOwnerOf(b,a.entity));case dorado.widget.DataSet.MESSAGE_DELETED:return(a.entity.parent==b||dorado.DataUtil.isOwnerOf(b,a.entity));case dorado.widget.DataSet.MESSAGE_INSERTED:return(a.entityList==b);case dorado.widget.DataSet.MESSAGE_ENTITY_STATE_CHANGED:return(a.entity.parent==b);default:return false}},processDataSetMessage:function(d,a,e){switch(d){case dorado.widget.DataSet.MESSAGE_REFRESH:this.refresh(true);
break;case dorado.widget.DataSet.MESSAGE_CURRENT_CHANGED:if(a.entityList==this._itemModel.getItems()){var b=this.getCurrentItem();if(!b||b.page.pageNo!=a.entityList.pageNo){this.refresh(true)}else{this.setCurrentEntity(a.entityList.current)}}else{this.refresh(true)}break;case dorado.widget.DataSet.MESSAGE_DATA_CHANGED:case dorado.widget.DataSet.MESSAGE_REFRESH_ENTITY:var c=this._itemModel.getItems();if(!c||c._observer!=this._dataSet){this.refresh(true)}else{this.refreshEntity(a.entity)}break;case dorado.widget.DataSet.MESSAGE_ENTITY_STATE_CHANGED:this.refreshEntity(a.entity);break;case dorado.widget.DataSet.MESSAGE_DELETED:this.onEntityDeleted(a);break;case dorado.widget.DataSet.MESSAGE_INSERTED:this.onEntityInserted(a);break}},doOnKeyDown:function(a){function e(){b.previous()}function c(){b.next()}function f(){try{b.move(-this._realLineSize)}catch(h){dorado.Exception.removeException(h)}}function d(){try{b.move(this._realLineSize)}catch(h){dorado.Exception.removeException(h)}}var g=true;
var b=this._itemModel.getItems();switch(a.keyCode){case 36:b.first();break;case 35:b.last();break;case 37:((this._blockLayout=="vertical")?e:f).call(this);g=false;break;case 39:((this._blockLayout=="vertical")?c:d).call(this);g=false;break;case 38:((this._blockLayout=="vertical")?f:e).call(this);g=false;break;case 40:((this._blockLayout=="vertical")?d:c).call(this);g=false;break}return g},highlightItem:function(a,b,c){var d=this._itemDomMap[a.entityId];if(d){$fly(d).effect("pulsate",{times:3},c||300)}}});