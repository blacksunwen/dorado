dorado.DataPipe=$class({$className:"dorado.DataPipe",runningProcNum:0,convertIfNecessary:function(c,a,b){return dorado.DataUtil.convertIfNecessary(c,a,b)},get:function(){return this.convertIfNecessary(this.doGet(),this.dataTypeRepository,this.dataType)},getAsync:function(b){b=b||dorado._NULL_FUNCTION;var a=this._waitingCallbacks;if(a){a.push(b)}else{this._waitingCallbacks=a=[b];this.runningProcNum++;this.doGetAsync({scope:this,callback:function(g,c){delete this._waitingCallbacks;this.runningProcNum=0;if(g){c=this.convertIfNecessary(c,this.dataTypeRepository,this.dataType)}var h;for(var d=0;d<a.length;d++){try{$callback(a[d],g,c)}catch(f){if(h===undefined){h=[]}h.push(f)}}if(h){throw ((h.length>1)?h:h[0])}}})}}});(function(){dorado.DataProvider=$class({$className:"dorado.DataProvider",supportsEntity:true,constructor:function(b){this.id=b;this.name=dorado.DataUtil.extractNameFromId(b)},getAjaxOptions:function(b){var d={action:"load-data",dataProvider:this.id,supportsEntity:this.supportsEntity};
if(b){d.parameter=dorado.JSON.evaluate(b.parameter);if(b.dataType){var c=b.dataType;if(c instanceof dorado.DataType){c=c.get("id")}else{if(typeof c=="string"){c=c}else{c=c.id}}d.resultDataType=c}d.pageSize=b.pageSize;d.pageNo=b.pageNo;d.context=b.view?b.view.get("context"):null}if(dorado.DataProvider._SYS_PARAMETER){d.sysParameter=dorado.DataProvider._SYS_PARAMETER;dorado.DataProvider._SYS_PARAMETER=null}if(this.supportsEntity&&this.dataTypeRepository){d.loadedDataTypes=this.dataTypeRepository.getLoadedDataTypes()}return dorado.Object.apply({jsonData:d},$setting["ajax.dataProviderOptions"])},convertEntity:function(e,b,d,c){if(e==null){return e}e=dorado.DataUtil.convertIfNecessary(e,b,d);if(e instanceof dorado.EntityList){e.dataProvider=this;e.parameter=c.jsonData.parameter;e.pageSize=c.jsonData.pageSize}else{if(e instanceof dorado.Entity){e.dataProvider=this;e.parameter=c.jsonData.parameter}}return e},getResult:function(c){var d=this.getAjaxOptions(c),g=dorado.Toolkits.getAjax(d);var b=g.requestSync(d);
if(b.success){var e=b.getJsonData(),f;if(e&&(e.$dataTypeDefinitions||e.$context)){f=e.data;if(e.$dataTypeDefinitions){this.dataTypeRepository.parseJsonData(e.$dataTypeDefinitions)}if(e.$context&&c&&c.view){c.view.set("context",e.$context)}}else{f=e}if(f&&this.supportsEntity){f=this.convertEntity(f,this.dataTypeRepository,this.dataType,d)}return f}else{throw b.error}},getResultAsync:function(b,i){var f=this.getAjaxOptions(b),h=dorado.Toolkits.getAjax(f);var e=this.dataType,d=this.supportsEntity,c=this.dataTypeRepository;var g=this.message;if(g==null){g=f.message}if(g===undefined){g=$resource("dorado.data.DataProviderTaskIndicator")}if(g){f.message=g}h.request(f,{scope:this,callback:function(m,j){if(m){var k=j.getJsonData(),l;if(k&&(k.$dataTypeDefinitions||k.$context)){l=k.data;if(k.$dataTypeDefinitions){this.dataTypeRepository.parseJsonData(k.$dataTypeDefinitions)}if(k.$context&&b&&b.view){b.view.set("context",k.$context)}}else{l=k}if(l&&d){l=this.convertEntity(l,c,e,f)}$callback(i,true,l,{scope:this})
}else{$callback(i,false,j.error,{scope:this})}}})}});dorado.AjaxDataProvider=$extend(dorado.DataProvider,{$className:"dorado.AjaxDataProvider",constructor:function(b){if(typeof b=="string"){b={url:b}}this._baseOptions=b||{}},getAjaxOptions:function(b){var c=dorado.Object.apply({},this._baseOptions),d=c.jsonData={};if(this._baseOptions.jsonData){dorado.Object.apply(d,this._baseOptions.jsonData)}if(b){d.parameter=dorado.JSON.evaluate(b.parameter);d.pageSize=b.pageSize;d.pageNo=b.pageNo}if(dorado.DataProvider._SYS_PARAMETER){d.sysParameter=dorado.DataProvider._SYS_PARAMETER;dorado.DataProvider._SYS_PARAMETER=null}return c}});var a={};dorado.DataProvider.create=function(c){var b=a[c];if(b===undefined){a[c]=b=new dorado.DataProvider(c)}return b}})();dorado.DataProviderPipe=$extend(dorado.DataPipe,{$className:"dorado.DataProviderPipe",getDataProvider:function(){return this.dataProvider},doGet:function(){return this.doGetAsync()},doGetAsync:function(c){var b=this.getDataProviderArg(),a=this.getDataProvider();
a.dataTypeRepository=this.dataTypeRepository;a.dataType=this.dataType;if(c){a.getResultAsync(b,c)}else{return a.getResult(b)}}});(function(){dorado.DataResolver=$class({$className:"dorado.DataResolver",supportsEntity:true,constructor:function(b){this.id=b;this.name=dorado.DataUtil.extractNameFromId(b)},getAjaxOptions:function(b){var c={action:"resolve-data",dataResolver:this.id,supportsEntity:this.supportsEntity};if(b){c.dataItems=b.dataItems;c.parameter=dorado.JSON.evaluate(b.parameter);c.context=b.view?b.view.get("context"):null}if(dorado.DataProvider._SYS_PARAMETER){c.sysParameter=dorado.DataProvider._SYS_PARAMETER;dorado.DataProvider._SYS_PARAMETER=null}if(this.supportsEntity&&this.dataTypeRepository){c.loadedDataTypes=this.dataTypeRepository.getLoadedDataTypes()}return dorado.Object.apply({jsonData:c},$setting["ajax.dataResolverOptions"])},resolve:function(c){var d=this.getAjaxOptions(c),e=dorado.Toolkits.getAjax(d);var b=e.requestSync(d);if(b.success){var b=b.getJsonData();if(b&&(b.$dataTypeDefinitions||b.$context)){b=b.data;
if(b.$dataTypeDefinitions){this.dataTypeRepository.parseJsonData(b.$dataTypeDefinitions)}if(json.$context&&c&&c.view){c.view.set("context",json.$context)}}if(b&&this.supportsEntity){b.returnValue=dorado.DataUtil.convertIfNecessary(b.returnValue,this.dataTypeRepository)}return b}else{throw b.error}},resolveAsync:function(b,g){var d=this.getAjaxOptions(b),c=this.supportsEntity,f=dorado.Toolkits.getAjax(d);var e=this.message;if(e==null){e=d.message}if(e===undefined){e=$resource("dorado.data.DataResolverTaskIndicator")}if(e){d.message=e}f.request(d,{scope:this,callback:function(i,h){if(i){var h=h.getJsonData();if(h&&(h.$dataTypeDefinitions||h.$context)){h=h.data;if(h.$dataTypeDefinitions){this.dataTypeRepository.parseJsonData(h.$dataTypeDefinitions)}if(json.$context&&b&&b.view){b.view.set("context",json.$context)}}if(h&&c){h.returnValue=dorado.DataUtil.convertIfNecessary(h.returnValue,this.dataTypeRepository)}$callback(g,true,h,{scope:this})}else{$callback(g,false,h.error,{scope:this})}}})}});
dorado.AjaxDataResolver=$extend(dorado.DataResolver,{$className:"dorado.AjaxDataResolver",constructor:function(b){if(typeof b=="string"){b={url:b}}this._baseOptions=b||{}},getAjaxOptions:function(b){var c=dorado.Object.apply({},this._baseOptions),d=c.jsonData={};if(this._baseOptions.jsonData){dorado.Object.apply(d,this._baseOptions.jsonData)}d.action="resolve-data";d.dataResolver=this.name;if(b){d.dataItems=b.dataItems;d.parameter=dorado.JSON.evaluate(b.parameter)}if(dorado.DataProvider._SYS_PARAMETER){d.sysParameter=dorado.DataProvider._SYS_PARAMETER;dorado.DataProvider._SYS_PARAMETER=null}return c}});var a={};dorado.DataResolver.create=function(c){var b=a[c];if(b===undefined){a[c]=b=new dorado.DataResolver(c)}return b}})();dorado.DataType=$extend(dorado.AttributeSupport,{$className:"dorado.DataType",ATTRIBUTES:{name:{readOnly:true},id:{writeOnce:true},dataTypeRepository:{readOnly:true}},constructor:function(c){$invokeSuper.call(this,arguments);var b;if(c&&c.constructor==String){b=c;c=null
}else{if(c){b=c.name;delete c.name;this.set(c)}}this._name=b?b:dorado.Core.newId();if(!this._id){this._id=this._name}if(this.id){if(window[this.id]===undefined){window[this.id]=this}else{var a=window[this.id];if(a instanceof Array){a.push(this)}else{window[this.id]=[a,this]}}}},parse:function(b,a){return b},getListenerScope:function(){return(this._dataTypeRepository)?this._dataTypeRepository.view:null},toText:function(b,a){if(b===null||b===undefined||(typeof b!=="object"&&isNaN(b))){return""}else{return b+""}}});dorado.DataType.getSubName=function(a){var b=/^[\w.$:@#]*\[[\w\[\].$:@#]*\]$/;return(a.match(b))?a.substring(a.indexOf("[")+1,a.length-1):null};dorado.AggregationDataType=$extend(dorado.DataType,{$className:"dorado.AggregationDataType",ATTRIBUTES:{elementDataType:{getter:function(){return this.getElementDataType("always")},writeOnce:true},pageSize:{defaultValue:0}},constructor:function(a,b){$invokeSuper.call(this,arguments);if(b){this._elementDataType=b}},getElementDataType:function(b){var a=this._elementDataType;
if(a!=null){a=dorado.LazyLoadDataType.dataTypeTranslator.call(this,a,b);if(a instanceof dorado.DataType){this._elementDataType=a}}return a},parse:function(a){if(a!=null){return(a instanceof dorado.EntityList)?a:new dorado.EntityList(a,this._dataTypeRepository,this)}else{return null}}});dorado.EntityDataType=$extend([dorado.DataType,dorado.EventSupport],{$className:"dorado.EntityDataType",ATTRIBUTES:{acceptUnknownProperty:{},defaultDisplayProperty:{},acceptValidationState:{defaultValue:"ok"},propertyDefs:{setter:function(a,c){if(c){for(var b=0;b<c.length;b++){this.addPropertyDef(c[b])}}}}},EVENTS:{beforeCurrentChange:{},onCurrentChange:{},beforeInsert:{},onInsert:{},beforeRemove:{},onRemove:{},beforeDataChange:{},onDataChange:{},beforeStateChange:{},onStateChange:{},onEntityToText:{}},constructor:function(a){this._propertyDefs=new dorado.util.KeyedArray(function(b){return b._name});$invokeSuper.call(this,arguments)},addPropertyDef:function(b){if(b instanceof dorado.PropertyDef){if(b._parent){var a=b._parent;
if(a.getPropertyDef(b._name)==b){a._propertyDefs.remove(b)}}}else{b=dorado.Toolkits.createInstance("propertydef",b)}b._parent=this;this._propertyDefs.append(b);return b},getPropertyDef:function(a){return this._propertyDefs.get(a)},parse:function(a){if(a!=null){return(a instanceof dorado.Entity)?a:new dorado.Entity(a,this._dataTypeRepository,this)}else{return null}},extend:function(b){if(typeof b=="string"){b={name:b}}else{b=b||{}}var a=this;jQuery(["acceptUnknownProperty","tag"]).each(function(d,e){if(b[e]===undefined){b[e]=a.get(e)}});var c=new this.constructor(b);c._events=dorado.Core.clone(this._events);this._propertyDefs.each(function(d){c.addPropertyDef(dorado.Core.clone(d))});return c}});(function(){dorado.datatype={};var b=dorado.DataType;b.STRING=1;b.PRIMITIVE_INT=2;b.INTEGER=3;b.PRIMITIVE_FLOAT=4;b.FLOAT=5;b.PRIMITIVE_BOOLEAN=6;b.BOOLEAN=7;b.DATE=8;dorado.datatype.StringDataType=$extend(b,{$className:"dorado.datatype.StringDataType",_code:b.STRING,parse:function(d,c){return(d==null)?null:(d+"")
},toText:function(d,c){return(d==null)?"":d+""}});dorado.$String=new dorado.datatype.StringDataType("String");$parseFloat=dorado.util.Common.parseFloat;$parseInt=function(c){return Math.round($parseFloat(c))};$formatFloat=dorado.util.Common.formatFloat;dorado.datatype.PrimitiveIntDataType=$extend(b,{$className:"dorado.datatype.PrimitiveIntDataType",_code:b.PRIMITIVE_INT,parse:function(d,c){var e=$parseInt(d);return(isNaN(e))?0:e},toText:$formatFloat});dorado.$int=new dorado.datatype.PrimitiveIntDataType("int");dorado.datatype.IntegerDataType=$extend(b,{$className:"dorado.datatype.IntegerDataType",_code:b.INTEGER,parse:function(d,c){var e=$parseInt(d);return(isNaN(e))?null:e},toText:$formatFloat});dorado.$Integer=new dorado.datatype.IntegerDataType("Integer");dorado.datatype.PrimitiveFloatDataType=$extend(b,{$className:"dorado.datatype.PrimitiveFloatDataType",_code:b.PRIMITIVE_FLOAT,parse:function(d,c){var e=$parseFloat(d);return(isNaN(e))?0:e},toText:$formatFloat});dorado.$float=new dorado.datatype.PrimitiveFloatDataType("float");
dorado.datatype.FloatDataType=$extend(b,{$className:"dorado.datatype.FloatDataType",_code:b.FLOAT,parse:function(d,c){var e=$parseFloat(d);return(isNaN(e))?null:e},toText:$formatFloat});dorado.$Float=new dorado.datatype.FloatDataType("Float");function a(d,c){if(c==null){if(d==null){return false}if(d.constructor==String){return(d.toLowerCase()=="true")}else{return !!d}}else{return(d===c)}}dorado.datatype.PrimitiveBooleanDataType=$extend(b,{$className:"dorado.datatype.PrimitiveBooleanDataType",_code:b.PRIMITIVE_BOOLEAN,parse:a});dorado.$boolean=new dorado.datatype.PrimitiveBooleanDataType("boolean");dorado.datatype.BooleanDataType=$extend(b,{$className:"dorado.datatype.BooleanDataType",_code:b.BOOLEAN,parse:function(d,c){if(d==null){return null}return a(d,c)}});dorado.$Boolean=new dorado.datatype.BooleanDataType("Boolean");dorado.datatype.DateDataType=$extend(b,{$className:"dorado.datatype.DateDataType",_code:b.DATE,parse:function(e,d){if(e==null||e==""){return null}if(e instanceof Date){return e
}if(isFinite(e)){return new Date(e)}var c=Date.parseDate(e,d||$setting["common.defaultDateFormat"]);if(c==null){var f=$setting["common.defaultTimeFormat"];if(f){c=Date.parseDate(e,f);if(c==null){e=new Date(e)}}}if(c==null){throw new dorado.ResourceException("dorado.data.BadDateFormat",e)}return c},toText:function(d,c){return(d!=null&&d instanceof Date)?d.dateFormat(c||$setting["common.defaultDateFormat"]):""}});dorado.$Date=new dorado.datatype.DateDataType("Date")})();(function(){var g=false;function f(j,i){var h=new e(j,dorado.LazyLoadDataType.create(this,i));this.register(h);return h}dorado.LazyLoadDataType=$class({$className:"dorado.LazyLoadDataType",constructor:function(h,i){this.dataTypeRepository=h;this.id=i},get:function(h){return this.dataTypeRepository.get(this.id,h)},getAsync:function(h,i){this.dataTypeRepository.getAsync(this.id,i,h)},toString:function(){return dorado.defaultToString(this)}});dorado.LazyLoadDataType.create=function(h,m){var k=dorado.DataUtil.extractNameFromId(m);
var i=h._get(k);if(i instanceof dorado.DataType){return i}else{if(i&&i!=DataTypeRepository.UNLOAD_DATATYPE){return h.get(k)}else{var j=dorado.DataType.getSubName(m);if(j){var l=f.call(h,k,j);l.set("id",m);return l}else{h.register(k);return new dorado.LazyLoadDataType(h,m)}}}};dorado.LazyLoadDataType.dataTypeTranslator=function(i,h){if(i.constructor==String){var j;if(this.getDataTypeRepository){j=this.getDataTypeRepository()}else{if(this.ATTRIBUTES&&this.ATTRIBUTES.dataTypeRepository){j=this.get("dataTypeRepository")}}if(!j){j=dorado.DataTypeRepository.ROOT}if(j){i=dorado.LazyLoadDataType.create(j,i)}else{throw new dorado.ResourceException("dorado.data.RepositoryUndefined")}}h=h||"always";if(h=="always"){if(i instanceof dorado.LazyLoadDataType){i=i.get()}}else{if(h=="auto"){if(i instanceof dorado.LazyLoadDataType){i.getAsync()}}}if(!(i instanceof dorado.DataType)){i=null}return i};dorado.LazyLoadDataType.dataTypeGetter=function(i){var h=this._dataType;if(h!=null){h=dorado.LazyLoadDataType.dataTypeTranslator.call(this,h,i);
if(h instanceof dorado.DataType){this._dataType=h}}return h};dorado.DataTypePipe=$extend(dorado.DataPipe,{constructor:function(h,i){this.dataTypeRepository=h||$dataTypeRepository;this.loadOptions=h.loadOptions;this.id=i;this.name=dorado.DataUtil.extractNameFromId(i)},getAjaxOptions:function(){var h=this.dataTypeRepository;return dorado.Object.apply({jsonData:{action:"load-datatype",dataType:[this.id],context:(h.view?h.view.get("context"):null)}},this.loadOptions)},doGet:function(){return this.doGetAsync()},doGetAsync:function(l){var k=dorado.Toolkits.getAjax(this.loadOptions),i=this.dataTypeRepository;if(l){i.register(this.name,this);k.request(this.getAjaxOptions(),{scope:this,callback:function(s,m){if(s){var q=m.getJsonData(),r,o;if(q.$context){r=q.data;o=q.$context}else{r=q}if(i.parseJsonData(r)>0){var n=i._dataTypeMap[this.name];$callback(l,true,n,{scope:this})}if(o&&i.view){i.view.set("context",o)}}else{$callback(l,false,m.error,{scope:this})}}})}else{i.unregister(this.name);var h=k.requestSync(this.getAjaxOptions());
var j;if(i.parseJsonData(h.getJsonData())>0){j=i._dataTypeMap[this.name]}if(!j){throw new dorado.ResourceException("dorado.data.DataTypeLoadFailed",this.name)}return j}}});dorado.DataTypeRepository=DataTypeRepository=$extend(dorado.EventSupport,{$className:"dorado.DataTypeRepository",EVENTS:{onDataTypeRegister:{interceptor:function(m,k,h){var j=m(k,h);if(j!==false){for(var l=0;l<this.children.length;l++){this.children[l].fireEvent(k,h)}}return j}}},constructor:function(h){this._dataTypeMap={};this.parent=h;if(h){h.children.push(this)}this.children=[];this.loadOptions=dorado.Object.apply({},$setting["ajax.dataTypeRepositoryOptions"])},destroy:function(){if(this.parent){this.parent.children.remove(this)}},addListener:function(){g=true;return $invokeSuper.call(this,arguments)},parseSingleDataType:function(k){var h,i=k.name,j=k.$type;delete k.name;delete k.$type;if(j=="Aggregation"){h=new dorado.AggregationDataType(i)}else{h=new dorado.EntityDataType(i)}if(h){h.loadFromServer=true;h._dataTypeRepository=this;
h.set(k)}return h},parseJsonData:function(k){var m=0,l=this._dataTypeMap,h;if(k instanceof Array){m=k.length;for(var j=0;j<m;j++){this.register(this.parseSingleDataType(k[j]))}}else{this.register(this.parseSingleDataType(k));m++}return m},register:function(i,h){if(i.constructor==String){h=h||DataTypeRepository.UNLOAD_DATATYPE}else{h=i;i=i._name}if(this._dataTypeMap[i] instanceof dorado.DataType){return}this._dataTypeMap[i]=h;if(h instanceof dorado.DataType){h._dataTypeRepository=this;if(g){this.fireEvent("onDataTypeRegister",this,{dataType:h})}}},unregister:function(h){delete this._dataTypeMap[h]},_get:function(i){var h=this._dataTypeMap[i];if(!h&&this.parent){h=this.parent._get(i)}return h},get:function(k,i){var m=k,k=dorado.DataUtil.extractNameFromId(m);var h=this._get(k);if(h==DataTypeRepository.UNLOAD_DATATYPE){var j=dorado.DataType.getSubName(m);if(j){h=f.call(this,k,j);h.set("id",m)}else{i=i||"always";if(i=="always"){var l=new dorado.DataTypePipe(this,m);h=l.get()}else{if(i=="auto"){this.getAsync(m)
}h=null}}}else{if(h instanceof dorado.DataTypePipe){var l=h;if(i=="always"){h=l.get(callback)}else{h=null}}else{if(!h){var j=dorado.DataType.getSubName(m);if(j){h=f.call(this,k,j);h.set("id",m)}}}}return h},getAsync:function(k,n,i){var m=k,k=dorado.DataUtil.extractNameFromId(m);var h=this._get(k);if(h==DataTypeRepository.UNLOAD_DATATYPE){var j=dorado.DataType.getSubName(m);if(j){h=f.call(this,k,j);h.set("id",m)}else{i=i||"always";if(i!="never"){var l=new dorado.DataTypePipe(this,m);l.getAsync(n);return}}}else{if(h instanceof dorado.DataTypePipe){var l=h;if(i!="never"){l.getAsync(n);return}}else{if(!h){var j=dorado.DataType.getSubName(m);if(j){h=f.call(this,k,j);h.set("id",m)}}}}$callback(n,true,h)},getLoadedDataTypes:function(){function j(l,q){var o=l._dataTypeMap;for(var m in o){var n=o[m];if(n.loadFromServer&&!(n instanceof dorado.AggregationDataType)){q[m]=true}}if(l.parent){j(l.parent,q)}}var k={},h=[];j(this,k);for(var i in k){h.push(i)}return h}});var d=dorado.DataType;var b=new DataTypeRepository();
DataTypeRepository.ROOT=b;DataTypeRepository.UNLOAD_DATATYPE={};window.$dataTypeRepository=DataTypeRepository.ROOT;var c=dorado.$String;b.register(c);c=dorado.$int;b.register("byte",c);b.register("char",c);b.register("short",c);b.register("int",c);b.register("long",c);c=dorado.$Integer;b.register("Byte",c);b.register("Character",c);b.register("Short",c);b.register("Integer",c);b.register("Long",c);c=dorado.$float;b.register("float",c);b.register("double",c);c=dorado.$Float;b.register("Float",c);b.register("Double",c);b.register("BigDecimal",c);c=dorado.$boolean;b.register(c);c=dorado.$Boolean;b.register(c);c=dorado.$Date;b.register("Date",c);b.register("Calendar",c);var e=dorado.AggregationDataType;b.register(new e("List"));b.register(new e("Set"));b.register(new e("Array"));var a=dorado.EntityDataType;b.register(new a("Bean"));b.register(new a("Map"));b.register(new a("Entity"))})();(function(){dorado.PropertyDef=$extend(dorado.AttributeSupport,{$className:"dorado.PropertyDef",ATTRIBUTES:{name:{readOnly:true},parent:{readOnly:true},dataType:{getter:dorado.LazyLoadDataType.dataTypeGetter,writeOnce:true},label:{getter:function(){var b=this._label;
if(b==null){b=this._name}return b}},description:{},readOnly:{},visible:{defaultValue:true},key:{},typeFormat:{},displayFormat:{},mapping:{setter:function(b,d){this._mapping=d;if(d&&d.length>0){var c=this._mappingIndex={};for(var f=0;f<d.length;f++){var e=d[f].key;if(e==null){e="${null}"}else{if(e===""){e="${empty}"}}c[e+""]=d[f].value}}else{delete this._mappingIndex}delete this._mappingRevIndex}},acceptUnknownMapKey:{defaultValue:true},submitable:{defaultValue:true},required:{},defaultValue:{},validators:{setter:function(b,f){var c=[];for(var e=0;e<f.length;e++){var d=f[e];if(!(d instanceof dorado.validator.Validator)){d=dorado.Toolkits.createInstance("validator",d)}c.push(d)}this._validators=c}},dataTypeRepository:{getter:function(b){var c=this.get("parent");return(c)?c.get(b):null},readOnly:true},cacheable:{}},constructor:function(c,b){$invokeSuper.call(this,arguments);if(c){if(c.constructor==String){this._name=c;this._dataType=b}else{this._name=c.name;delete c.name;this.set(c)}}},getDataType:function(b){return dorado.LazyLoadDataType.dataTypeGetter.call(this,b)
},getMappedValue:function(b){if(b==null){b="${null}"}else{if(b===""){b="${empty}"}}return this._mappingIndex?this._mappingIndex[b+""]:undefined},getMappedKey:function(f){if(!this._mappingRevIndex){var d=this._mappingRevIndex={},c=this._mapping;for(var e=0;e<c.length;e++){var b=c[e].value;if(b==null){b="${null}"}else{if(b===""){b="${empty}"}}d[b+""]=c[e].key}}if(f==null){f="${null}"}else{if(f===""){f="${empty}"}}return this._mappingRevIndex[f+""]}});dorado.BasePropertyDef=$extend(dorado.PropertyDef,{$className:"dorado.BasePropertyDef",ATTRIBUTES:{key:{}}});dorado.ReferenceDataPipe=$extend(dorado.DataProviderPipe,{$className:"dorado.ReferenceDataPipe",constructor:function(d,b){this.propertyDef=d;this.entity=b;this.dataType=d._dataType;var c=d.get("parent");this.dataTypeRepository=(c?c.get("dataTypeRepository"):null)||$dataTypeRepository;this.view=this.dataTypeRepository?this.dataTypeRepository.view:null},getDataProviderArg:function(){dorado.$this=this.entity;return{pageSize:this.propertyDef._pageSize,parameter:dorado.JSON.evaluate(this.propertyDef._parameter),dataType:this.dataType,view:this.view}
},getDataProvider:function(){return this.propertyDef._dataProvider}});dorado.Reference=$extend(dorado.PropertyDef,{$className:"dorado.Reference",ATTRIBUTES:{dataProvider:{},parameter:{},pageSize:{},cacheable:{defaultValue:true}},getDataPipe:function(b){return new dorado.ReferenceDataPipe(this,b)}});var a={};dorado.LookupDataPipe=$extend(dorado.DataPipe,{$className:"dorado.LookupDataPipe",constructor:function(d,b){this.propertyDef=d;this.entity=b;this.dataType=d._dataType;var c=d.get("parent");this.dataTypeRepository=(c?c.get("dataTypeRepository"):null)||$dataTypeRepository},getLookupData:function(){var b=this.propertyDef.lookupData;if(!b){var c=this.propertyDef;if(c._dataSet){b=c._dataSet.getData()}else{if(c._dataProvider){b=c._dataProvider.getResult()}}}return this.propertyDef.lookupData=b},getLookupDataAsync:function(d){if(!this.propertyDef.lookupData){var c=this.propertyDef;var b={scope:this,callback:function(f,e){if(f){this.propertyDef.lookupData=e}$callback(d,f,e)}};if(c._dataSet){c._dataSet.getDataAsync(b)
}else{if(c._dataProvider){c._dataProvider.getResultAsync(b)}}}else{$callback(d,true,this.propertyDef.lookupData)}},getIndex:function(){function h(m){var s=k._constraints;var o=[];for(var n=0;n<s.length;n++){var r=s[n];var q=dorado.DataPath.create(r.lookupKeyProperty);o.push(q.evaluate(m))}return o.join("^^")}var k=this.propertyDef;if(!k.cacheKey){k.cacheKey=(k._dataSet)?k._dataSet.id:(k._dataProvider)?("dp:"+k._dataProvider.name):null;if(k.cacheKey){k.cacheKey+="|"+k._lookupProperty+"|";var c=k._constraints;for(var g=0;g<c.length;g++){var b=c[g];k.cacheKey+=","+b.lookupKeyProperty}}}var j=a[k.cacheKey];if(!j){a[k.cacheKey]=j={};var f=this.propertyDef.lookupData;if(f){var l=(k._lookupProperty)?dorado.DataPath.create(k._lookupProperty):null;if(f instanceof Array){for(var g=0;g<f.length;g++){var d=f[g];j[h.call(this,d)]=(l)?l.evaluate(d,true):d}}else{if(f instanceof dorado.EntityList){for(var e=f.iterator();e.hasNext();){var d=e.next();j[h.call(this,d)]=(l)?l.evaluate(d,true):d}}else{j[h.call(this,f)]=(l)?l.evaluate(f,true):f
}}}}return j},getKey:function(b){dorado.$this=b;var f=this.propertyDef._constraints;var d=[];for(var c=0;c<f.length;c++){var e=f[c];if(e.keyProperty){d.push(b.get(e.keyProperty))}else{d.push(dorado.JSON.evaluate(e.keyValue))}}return d.join("^^")},doGet:function(){this.getLookupData();var b=this.getKey(this.entity);return this.getIndex()[b?b:""]},doGetAsync:function(b){this.getLookupDataAsync({scope:this,callback:function(e,c){if(e){var d=this.getKey(this.entity);var c=this.getIndex()[d?d:""]}$callback(b,e,c)}})}});dorado.Lookup=$extend(dorado.PropertyDef,{$className:"dorado.Lookup",ATTRIBUTES:{dataProvider:{},dataSet:{},lookupProperty:{},constraints:{}},constructor:function(c,b){this._constraints=[];$invokeSuper.call(this,arguments)},getDataPipe:function(b){return new dorado.LookupDataPipe(this,b)},clearCache:function(){delete this.cacheKey}});dorado.Toolkits.registerPrototype("propertydef",{Default:dorado.BasePropertyDef,Reference:dorado.Reference,Lookup:dorado.Lookup})})();(function(){var c="error";
var a=dorado.Toolkits.STATE_CODE;var d={ok:0,invalid:1,executing:2};dorado.Entity=function(g,e,f){this.entityId=dorado.Core.getTimestamp()+"";this.timestamp=dorado.Core.getTimestamp();this.dataTypeRepository=e;this._propertyInfoMap={};if(g){this._data=g;if(f==null){if(e&&g.$dataType){f=e.get(g.$dataType)}}else{g.$dataType=f._id}}else{this._data=g={};if(f){this._data.$dataType=f._id}}this.dataType=f;if(f){this._propertyDefs=f._propertyDefs;this._propertyDefs.each(function(i){if(i._defaultValue!=undefined&&g[i._name]==undefined){g[i._name]=(i._defaultValue instanceof Function)?i._defaultValue.call(this):i._defaultValue}if(g[i._name]==null){var h=i.get("dataType");if(h){switch(h._code){case dorado.DataType.PRIMITIVE_INT:case dorado.DataType.PRIMITIVE_FLOAT:g[i._name]=0;break;case dorado.DataType.PRIMITIVE_BOOLEAN:g[i._name]=false;break}}}})}else{this._propertyDefs=null}if(this.acceptUnknownProperty==null){this.acceptUnknownProperty=(f)?f._acceptUnknownProperty:true}};dorado.Entity.STATE_NONE=0;
dorado.Entity.STATE_NEW=1;dorado.Entity.STATE_MODIFIED=2;dorado.Entity.STATE_DELETED=3;dorado.Entity._MESSAGE_DATA_CHANGED=3;dorado.Entity._MESSAGE_ENTITY_STATE_CHANGED=4;dorado.Entity._MESSAGE_REFRESH_ENTITY=5;$class({$className:"dorado.Entity",constructor:dorado.Entity,state:dorado.Entity.STATE_NONE,_observer:null,_disableObserversCounter:0,_messages:null,_setObserver:function(f){this._observer=f;var g=this._data;for(p in g){if(g.hasOwnProperty(p)){var e=g[p];if(e==null){continue}if(e instanceof dorado.Entity||e instanceof dorado.EntityList){e._setObserver(f)}}}},disableObservers:function(){this._disableObserversCounter++},enableObservers:function(){if(this._disableObserversCounter>0){this._disableObserversCounter--}},notifyObservers:function(){this.sendMessage(0)},sendMessage:function(f,e){if(this._disableObserversCounter==0&&this._observer){this._observer.entityMessageReceived(f,e)}},setState:function(f){if(this.state==f){return}var g={entity:this,oldState:this.state,newState:f,processDefault:true};
var e=this.dataType;if(e&&!this.disableEvents){e.fireEvent("beforeStateChange",e,g)}if(!g.processDefault){return}if(this.state==dorado.Entity.STATE_NONE&&f==dorado.Entity.STATE_MODIFIED){this.storeOldData()}this.state=f;this.timestamp=dorado.Core.getTimestamp();if(e&&!this.disableEvents){e.fireEvent("onStateChange",e,g)}this.sendMessage(dorado.Entity._MESSAGE_ENTITY_STATE_CHANGED,g)},_get:function(k,i,l,h){function m(r,q){if(q&&typeof q=="object"&&q.parent==this){return q}var o=r.get("dataType");if(o==null){return q}var n=(!(q instanceof dorado.EntityList)&&o instanceof dorado.AggregationDataType)||(!(q instanceof dorado.Entity)&&o instanceof dorado.EntityDataType);q=o.parse(q,r.get("typeFormat"));if((q instanceof dorado.Entity||q instanceof dorado.EntityList)&&q.parent!=this){q.parent=this;q._setObserver(this._observer)}if(n){this._data[r._name]=q}return q}var j=this._data[k];if(j===undefined){if(i){var g=null;if(h!="never"&&i.getDataPipe){var f=i.getDataPipe(this);if(f){if(l||h=="auto"){f.getAsync({scope:this,callback:function(q,n){if(q){if(i.get("cacheable")){var o=this._data[k];
if(o&&o.isDataPipeWrapper){o=o.value}if(o instanceof dorado.Entity||o instanceof dorado.EntityList){o.parent=null;o._setObserver(null)}this._data[k]=n;this.sendMessage(dorado.Entity._MESSAGE_DATA_CHANGED,{entity:this,property:k,newValue:n})}}if(l){$callback(l,q,n)}}});this._data[k]=g={isDataPipeWrapper:true,pipe:f};if(l){return}}else{j=f.get();if(i._cacheable){this._data[k]=j}}}}if(dorado.Entity.ALWAYS_RETURN_VALID_ENTITY_LIST){var e=i.get("dataType");if(j===undefined&&e instanceof dorado.AggregationDataType){j=e.parse([],i.get("typeFormat"));j.parent=this;j._setObserver(this._observer);if(g){g.value=j}else{if(h!="never"){this._data[k]=j}}}}}}else{if(j!=null&&j.isDataPipeWrapper){var f=j.pipe;if(h!="never"){if(l||h=="auto"){f.getAsync(l);if(l){return}}else{j=f.get()}}}else{if(i){j=m.call(this,i,j)}}}if(l){$callback(l,true,j)}return j},_getPropertyDef:function(e){var f=null;if(!this.acceptUnknownProperty&&this._propertyDefs){f=this._propertyDefs.get(e);if(!f){throw new dorado.ResourceException("dorado.data.UnknownProperty",e)
}}return f},get:function(j,f){f=f||"always";var h=j.split("."),e;for(var g=0;g<h.length;g++){j=h[g];if(g==0){var k=this._getPropertyDef(j);e=this._get(j,k,null,f)}else{if(!e){break}e=(e instanceof dorado.Entity)?e.get(j):e[j]}}return e},getAsync:function(i,k,f){f=f||"always";var h=i.split("."),g=0,e;var i=h[g];var j=this._getPropertyDef(i);if(h.length==1){this._get(i,j,k||dorado._NULL_FUNCTION,f)}else{this._get(i,j,{callback:function(n,l){if(n){var m=h[++g];if(l instanceof dorado.Entity){l.getAsync(m,k,f);return}else{l=l[m]}return}$callback(k,n,l)}},f)}},doGetText:function(g,j,e){function h(l,n){var m;if(n){var k=n.get("dataType");if(k){m=k.toText(l,n._displayFormat)}else{m=dorado.$String.toText(l)}if(m&&n._mapping){m=n.getMappedValue(m)}}else{m=dorado.$String.toText(l)}return m}var i=this._getPropertyDef(g);if(j){this.get(g,function(k){$callback(j,true,h(k,i))},e)}else{var f=this.get(g,e);return h(f,i)}},getText:function(f,e){return this.doGetText(f,null,e)},getTextAsync:function(f,g,e){this.doGetText(f,g||dorado._NULL_FUNCTION,e)
},storeOldData:function(){if(this._oldData){return}var e=this._data,g=this._oldData={};for(var f in e){if(e.hasOwnProperty(f)){g[f]=e[f]}}},_set:function(q,o,l){var e=this._data[q];var g={entity:this,property:q,oldValue:e,newValue:o,processDefault:true};var m=this.dataType;if(m&&!this.disableEvents&&m.fireEvent("beforeDataChange",m,g)){o=g.newValue}if(!g.processDefault){return}if(this.state==dorado.Entity.STATE_NONE){this.storeOldData()}if(e&&e.isDataPipeWrapper){e=e.value}if(e instanceof dorado.Entity||e instanceof dorado.EntityList){e.parent=null;e._setObserver(null)}if(o instanceof dorado.Entity||o instanceof dorado.EntityList){if(o.parent!=null){throw new dorado.ResourceException("dorado.data.ValueNotFree",((o instanceof dorado.Entity)?"Entity":"EntityList"))}o.parent=this;o._setObserver(this._observer)}this._data[q]=o;this.timestamp=dorado.Core.getTimestamp();var i=[];if(l){if(l._required&&(!o&&o!==false)){i.push({state:"error",text:$resource("dorado.data.ErrorContentRequired")})}else{if(l._mapping&&o!=null){var k=l.getMappedValue(o);
if(l._acceptUnknownMapKey&&k===undefined){i.push({state:"error",text:$resource("dorado.data.ErrorContentRequired")})}}else{var r=this._propertyInfoMap,j=r[q];if(!j){r[q]=j={}}if(l._validators){var h=this,f=this.timestamp,n=[];jQuery.each(l._validators,function(t,s){if(s instanceof dorado.validator.RemoteValidator&&s._async){n.push(function(u){s.validate(o,{callback:function(w,v){if(w){if(h.timestamp!=f){return}h.setMessages(q,v)}$callback(u,w,v)}})})}else{i=s.validate(o)}});if(n.length){j.validating=n.length;$waitFor(n,function(){if(h.timestamp!=f){return}j.validating=0;j.validated=true})}else{j.validated=true}}else{j.validated=true}}}}this.doSetMessages(q,(i&&i.length)?i:null);if(this.state==dorado.Entity.STATE_NONE){this.setState(dorado.Entity.STATE_MODIFIED)}if(m&&!this.disableEvents){m.fireEvent("onDataChange",m,g)}this.sendMessage(dorado.Entity._MESSAGE_DATA_CHANGED,g)},set:function(g,f){var h=this._getPropertyDef(g);if(h){var e=h.get("dataType");if(e){f=e.parse(f,h._typeFormat)}}this._set(g,f,h)
},setText:function(g,h){var i=this._getPropertyDef(g),f=h;if(i){if(i._mapping&&h!=null){f=i.getMappedKey(h);if(f===undefined){f=h}}var e=i.get("dataType");if(e){f=e.parse(f,i._displayFormat)}}this._set(g,f,i)},cancel:function(){if(this.state==dorado.Entity.STATE_NEW){this.remove()}else{if(this.state!=dorado.Entity.STATE_NONE){var e=this._data,g=this._oldData;if(g){for(var f in e){if(e.hasOwnProperty(f)){delete e[f]}}for(var f in g){if(g.hasOwnProperty(f)){e[f]=g[f]}}}this.reset();this.sendMessage(0)}}},reset:function(){this._propertyInfoMap={};delete this._messages;delete this._messageState;this.setState(dorado.Entity.STATE_NONE);delete this._oldData},createBrother:function(g,f){var e=new dorado.Entity(g,this.dataTypeRepository,this.dataType);if(!f&&this.parent instanceof dorado.EntityList){this.parent.insert(e)}return e},createChild:function(m,i,g){var e=null;if(this.dataType){var l=this._getPropertyDef(m);if(!l){throw new dorado.ResourceException("dorado.data.UnknownProperty",m)}var j=l.get("dataType"),f;
if(j&&j instanceof dorado.AggregationDataType){f=j;j=j.getElementDataType()}if(j&&!(j instanceof dorado.EntityDataType)){throw new ResourceException("dorado.data.EntityPropertyExpected",m)}e=new dorado.Entity(i,this.dataTypeRepository,j);if(!g){if(f){var k=this._get(m,l);k.insert(e)}else{this._set(m,e,l)}}}else{e=new dorado.Entity(i);if(!g){var h=this.get(m);if(h instanceof dorado.EntityList){h.insert(e)}else{if(h instanceof Array){h.push(e)}else{this.set(m,e)}}}}return e},setCurrent:function(){if(this.parent instanceof dorado.EntityList){this.parent.setCurrent(this)}},clearData:function(){var f=this._data;for(var e in f){if(!f.hasOwnProperty(e)){continue}delete f[e]}this.sendMessage(0)},fromJSON:function(e){if(this.dataType){e.$dataType=this.dataType._id}this._data=e;delete this._oldData;this.state=dorado.Entity.STATE_NONE;this.timestamp=dorado.Core.getTimestamp();this.sendMessage(0)},toJSON:function(q,e){var r={};var o=includeReferenceProperties=includeLookupProperties=true,i=generateState=generateEntityId=generateOldData=false,j=null,n=null;
if(q!=null){if(q.includeUnsubmitableProperties===false){o=false}if(q.includeReferenceProperties===false){includeReferenceProperties=false}if(q.includeLookupProperties===false){includeLookupProperties=false}i=q.generateDataType;generateState=q.generateState;generateEntityId=q.generateEntityId;generateOldData=q.generateOldData&&this._oldData;q.generateDataType=false;j=q.properties;n=q.entityFilter;if(j!=null&&j.length==0){j=null}}var g=this._data,h=this._oldData,f;for(var m in g){if(!g.hasOwnProperty(m)){continue}if(m.charAt(0)=="$"){continue}if(j&&j.indexOf(m)<0){continue}var k=(this._propertyDefs)?this._propertyDefs.get(m):null;if(!o&&k&&!k._submitable){continue}if(k instanceof dorado.Reference){if(!includeReferenceProperties){continue}}else{if(k instanceof dorado.Lookup){if(!includeLookupProperties){continue}}}var l=this._get(m,k);if(l!=null){if(l instanceof dorado.Entity){if(!n||n(l)){l=l.toJSON(q,e)}else{l=null}}else{if(l instanceof dorado.EntityList){l=l.toJSON(q,e)}}}if(generateOldData&&k&&k._key&&h[m]!=null){if(!f){f={}
}f[m]=h[m]}r[m]=l}if(i&&g.$dataType){r.$dataType=g.$dataType}if(generateState&&this.state!=dorado.Entity.STATE_NONE){r.$state=this.state}if(generateEntityId){r.$entityId=this.entityId}if(f){r.$oldData=f}if(q){q.generateDataType=i}if(e&&e.entities){e.entities.push(this)}return r},getData:function(){return this._data},getOldData:function(){return this._oldData},getMessages:function(f){var e;if(f){var g=this._propertyInfoMap[f];e=((g)?g.messages:null)}else{e=this._messages}return e},doSetMessages:function(h,f){function e(k){var m=null,r=-1;if(k._messages){m=dorado.Toolkits.getTopMessageState(k._messages);if(m){r=a[m]}}var q=k._propertyInfoMap;for(var o in q){var n=q[o];var l=a[n.state];if(l>r){r=l;m=n.state}}return m}if(f===undefined){throw new dorado.ResourceException("dorado.core.OperationNotSupported","dorado.Entity.doSetMessages");f=h;f=dorado.Toolkits.trimMessages(f,c);if(this._messages==f){return false}this._messages=f;if(dorado.Toolkits.getTopMessageState(f)!=this._messageState){this._messageState=e(this)
}}else{var j=this._propertyInfoMap;f=dorado.Toolkits.trimMessages(f,c);var i=j[h];if(i&&i.messages==f){return false}var g=dorado.Toolkits.getTopMessageState(f);if(!i){j[h]=i={}}i.state=g;i.messages=f;if(g!=this._messageState||g!=(i?i.state:null)){this._messageState=e(this)}}return true},setMessages:function(g,f){var e=this.doSetMessages(g,f);if(e){this.timestamp=dorado.Core.getTimestamp();if(g){this.sendMessage(dorado.Entity._MESSAGE_DATA_CHANGED,{entity:this,property:g})}else{this.sendMessage(0)}}return e},getMessageState:function(e){if(e){var f=this._propertyInfoMap;return f[e]?f[e].state:null}else{return this._messageState}},getValidateState:function(g){var f="unvalidate",h=this._propertyInfoMap;if(h){var e=h[g];if(e){if(e.validating){f="validating"}else{if(e.validated){f=this.getMessageState(g);if(!f||f=="info"){f="ok"}}}}}return f},validate:function(f){function o(y,x,B,z){var A=z.state||"error";y[A].push({entity:x,property:B,state:z.state,text:z.text})}var v=f?f.validateSimplePropertyOnly:false;
var e=f?f.context:null;var i,u,g,r=-1;if(e){e.info=[];e.ok=[];e.warn=[];e.error=[];e.executing=[];e.executingValidationNum=0}var m=false,j;var s=this.dataType,k=this._propertyInfoMap;if(s){this._propertyDefs=s._propertyDefs;var l=this;this._propertyDefs.each(function(x){var C=x._name,B=k[C];if(B){if(B.validating){m=true;if(e){e.executingValidationNum=(e.executingValidationNum||0)+B.validating;var y=e.executing=e.executing||[];y.push({entity:this,property:C,num:B.validating})}}else{if(e&&B.messages){for(var z=0;z<B.messages.length;z++){o(e,this,C,B.messages[z])}}}}if(x._required&&(!B||!B.validated)){if(!B){k[C]=B={}}B.validated=true;var A=l._data[C];if(!A&&A!==false){j={state:"error",text:$resource("dorado.data.ErrorContentRequired")};l.setMessages(C,[j]);if(e){o(e,this,C,j)}}}})}if(v){var w=this._data;for(var n in w){if(!w.hasOwnProperty(n)){continue}var q=w[n];if(q instanceof dorado.Entity){i=q.validate(f);g=d[i];if(g>r){r=g;u=i}}else{if(q instanceof dorado.EntityList){var h=q.iterator();
while(h.hasNext()){i=h.next().validate(f);g=d[i];if(g>r){r=g;u=i}}}}}}state=this.getMessageState();var t=this.dataType?this.dataType.get("acceptValidationState"):null;if(a[state||"info"]<=a[t||"ok"]){i=m?"executing":"ok"}else{i="invalid"}g=d[i];if(g>r){r=g;u=i}if(e){e.result=u}return u},isDirty:function(f){if(this.state==dorado.Entity.STATE_NONE){return false}if(f){var e=false,g=this._oldData;if(g){e=(g[f]!=this._data[f])}else{e=(this._data[f]!=null)}return e}else{return this.state!=dorado.Entity.STATE_NONE}},flush:function(h){function g(i){if(i instanceof Array&&i.length>1){throw new dorado.ResourceException("dorado.data.TooMoreResult")}}if(!this.dataType||!this.dataProvider){throw new dorado.ResourceException("dorado.data.DataProviderUndefined")}var f={parameter:this.parameter};this.dataProvider.supportsEntity=false;if(h){this.dataProvider.getResultAsync(f,{scope:this,callback:function(j,i){if(j){this.fromJSON(i)}$callback(h,j,((j)?this:i))}})}else{var e=this.dataProvider.getResult(f);
this.fromJSON(e)}},flushAsync:function(e){this.flush(e||dorado._NULL_FUNCTION)},remove:function(e){if(this.parent){this.parent.remove(this,e)}},toString:function(){var f;if(this.dataType){var e=this.dataType;var g={entity:this,processDefault:true};if(!this.disableEvents&&e.getListenerCount("onEntityToText")){g.processDefault=false;e.fireEvent("onEntityToText",e,g)}if(g.processDefault){if(e._defaultDisplayProperty){f=this.getText(e._defaultDisplayProperty,"never")}if(f===undefined){f="[Entity]"}}}else{f="[Entity]"}return f},clone:function(){var e=dorado.Core.clone(this._data);return new dorado.Entity(e,this.dataTypeRepository,this.dataType)}});dorado.Entity.ALWAYS_RETURN_VALID_ENTITY_LIST=true;var b={};dorado.Entity.getDummyEntity=function(e){var f=b[e];if(!f){b[e]=f=new dorado.Entity();f.get=f.set=f.getState=dorado._NULL_FUNCTION;f.dummy=true;f.page={pageNo:e}}return f}})();(function(){dorado.EntityList=function(d,b,c){this.timestamp=dorado.Core.getTimestamp();this.dataTypeRepository=b;
if(d){if(c==null){if(b&&d.$dataType){c=b.get(d.$dataType)}}else{d.$dataType=c._id}}this.dataType=c;this.elementDataType=(c)?c.getElementDataType():null;this.pageSize=(c)?c._pageSize:0;this.pageNo=1;this.pageCount=0;this.entityCount=0;this._pages=[];this._keyMap={};if(d!=null){this.fromJSON(d)}};dorado.EntityList._MESSAGE_CURRENT_CHANGED=10;dorado.EntityList._MESSAGE_DELETED=11;dorado.EntityList._MESSAGE_INSERTED=12;$class({$className:"dorado.EntityList",constructor:dorado.EntityList,_disableObserversCounter:0,_setObserver:function(b){this._observer=b;this.each(function(c){if(c instanceof dorado.Entity){c._setObserver(b)}})},disableObservers:dorado.Entity.prototype.disableObservers,enableObservers:dorado.Entity.prototype.enableObservers,notifyObservers:dorado.Entity.prototype.notifyObservers,sendMessage:function(c,b){if(this._disableObserversCounter==0&&this._observer){this._observer.entityMessageReceived(c,b)}},_findPreviousEntry:function(e,b,c){if(c==null){c=this.pageNo}var d=(e)?e.previous:null;
while(!(d&&d.data.state!=dorado.Entity.STATE_DELETED)){if(!d){if(c>1){c--;if(this.isPageLoaded(c)){d=this.getPage(c,b).last}}}else{d=d.previous}if(!d){break}}return d},_findNextEntry:function(e,b,c){if(c==null){c=this.pageNo}var d=(e)?e.next:null;while(!(d&&d.data.state!=dorado.Entity.STATE_DELETED)){if(!d){if(c<this.pageCount){c++;if(this.isPageLoaded(c)){d=this.getPage(c,b).first}}}else{d=d.next}if(!d){break}}return d},_throwInvalidEntity:function(b){throw new dorado.ResourceException("dorado.data.InvalidEntityToList")},_throwNoCurrent:function(){throw new dorado.ResourceException("dorado.data.NoCurrent")},isPageLoaded:function(b){var c=this._pages[b];return(c&&c.loaded)},getPage:function(b,g,h){if(b>0&&b<=this.pageCount){var d=this._pages[b];if(!d){d=new dorado.EntityList.Page(this,b);this._pages[b]=d}if(d.loaded){if(h){$callback(h,true,d);return}}else{if(g){if(this.dataProvider){var f=this.dataType,e;if(f){var c=f.get("dataTypeRepository");e=c?c.view:null}var i={parameter:this.parameter,pageSize:this.pageSize,pageNo:b,dataType:f,view:e};
this.dataProvider.supportsEntity=false;if(h){this.dataProvider.getResultAsync(i,{scope:this,callback:function(l,k){if(l){this._fillPage(d,k)}$callback(h,l,((l)?d:k))}});return}else{var j=this.dataProvider.getResult(i);this._fillPage(d,j)}}else{d.loaded=true}}}return d}else{throw new dorado.ResourceException("dorado.data.InvalidPage",b)}},setCurrent:function(d){if(this.current==d){return}if(d&&(!d.page||d.page.entityList!=this)){this._throwInvalidEntity(d)}if(d&&d.state==dorado.Entity.STATE_DELETED){throw new dorado.ResourceException("dorado.data.EntityDeleted")}var e={entityList:this,oldCurrent:this.current,newCurrent:d,processDefault:true};var b=this.dataType,c;if(b){c=b.getElementDataType()}if(c){c.fireEvent("beforeCurrentChange",c,e)}if(!e.processDefault){return}this.current=d;this.pageNo=(d)?d.page.pageNo:1;this.timestamp=dorado.Core.getTimestamp();if(c){c.fireEvent("onCurrentChange",c,e)}this.sendMessage(dorado.EntityList._MESSAGE_CURRENT_CHANGED,e)},hasPrevious:function(){if(this.current){var c=this.current.page;
var b=c.findEntry(this.current);b=this._findPreviousEntry(b,true);return b!=null}else{if(this.entityCount>0){this._throwNoCurrent()}}},hasNext:function(){if(this.current){var c=this.current.page;var b=c.findEntry(this.current);b=this._findNextEntry(b,true);return b!=null}else{if(this.entityCount>0){this._throwNoCurrent()}}},first:function(){var c=this._findNextEntry(null,true,0);var b=(c)?c.data:null;this.setCurrent(b);return b},previous:function(){if(this.current){var c=this.current.page;var b=c.findEntry(this.current);b=this._findPreviousEntry(b,true);if(b){this.setCurrent(b.data);return b.data}return null}else{if(this.entityCount>0){this._throwNoCurrent()}}},next:function(){if(this.current){var c=this.current.page;var b=c.findEntry(this.current);b=this._findNextEntry(b,true);if(b){this.setCurrent(b.data);return b.data}return null}else{if(this.entityCount>0){this._throwNoCurrent()}}},last:function(){var c=this._findPreviousEntry(null,true,this.pageCount+1);var b=(c)?c.data:null;this.setCurrent(b);
return b},move:function(e){var d=this.current.page;var c=d.findEntry(this.current);if(e>0){for(var b=0;b<e;b++){c=this._findNextEntry(c,true);if(!c&&this.entityCount>0){this._throwNoCurrent()}}}else{if(e<0){for(var b=0;b>e;b--){c=this._findPreviousEntry(c,true);if(!c&&this.entityCount>0){this._throwNoCurrent()}}}}this.setCurrent(c.data);return c.data},gotoPage:function(b,f){if(f){var d=this;this.getPage(b,true,{callback:function(j,g){if(j){var i=g.first;while(i&&i.data.state==dorado.Entity.STATE_DELETED){i=i.next}var h=(i)?i.data:null;if(h){d.setCurrent(h)}}$callback(f,j,g)}})}else{var e=this.getPage(b,true).first;while(e&&e.data.state==dorado.Entity.STATE_DELETED){e=e.next}var c=(e)?e.data:null;if(c){this.setCurrent(c)}return c}},firstPage:function(b){this.gotoPage(1,b)},previousPage:function(b){if(this.pageNo<=1){return}this.gotoPage(this.pageNo-1,b)},nextPage:function(b){if(this.pageNo>=this.pageCount){return}this.gotoPage(this.pageNo+1,b)},lastPage:function(b){this.gotoPage(this.pageCount,b)
},insert:function(c,e,g){if(c==null){c=new dorado.Entity(null,this.dataTypeRepository,this.elementDataType)}else{if(c instanceof dorado.Entity){if(c.page){var f=c.page.entityList;if(f){f.remove(c,true)}}}else{c=new dorado.Entity(c,this.dataTypeRepository,this.elementDataType)}}if(e=="before"||e=="after"){g=g||this.current;if(!g){e=(e=="before")?"begin":"after"}}var h={entityList:this,entity:c,insertMode:e,refEntity:g,processDefault:true};var b=c.dataType;if(b){b.fireEvent("beforeInsert",b,h)}if(!h.processDefault){return}if(this.pageCount==0&&this.pageNo==1){this.pageCount=1}var d=this.getPage(this.pageNo,true);d.insert(c,e,g);c.setState(dorado.Entity.STATE_NEW);d.entityCount++;this.entityCount++;this.timestamp=dorado.Core.getTimestamp();if(b){b.fireEvent("onInsert",b,h)}this.sendMessage(dorado.EntityList._MESSAGE_INSERTED,h);this.setCurrent(c);return c},remove:function(e,h){if(!e){if(!this.current){this._throwNoCurrent()}e=this.current}if(e.parent!=this){this._throwInvalidEntity()}var c={entity:e,entityList:this,processDefault:true};
var i=e.dataType,k=(e.state==dorado.Entity.STATE_DELETED);if(!k){if(i){i.fireEvent("beforeRemove",i,c)}if(!c.processDefault){return}}var b=(this.current==e);var g=null;if(b){var j=e.page.findEntry(this.current);var d=this._findNextEntry(j);if(!d){d=this._findPreviousEntry(j)}if(d){g=d.data}}var f=e.page;if(k){h=true}else{f.entityCount--;this.entityCount--;h=h||e.state==dorado.Entity.STATE_NEW;e.setState(dorado.Entity.STATE_DELETED)}this.timestamp=dorado.Core.getTimestamp();if(!k){if(i){i.fireEvent("onRemove",i,c)}this.sendMessage(dorado.EntityList._MESSAGE_DELETED,c)}if(h){f.remove(e)}if(b){this.setCurrent(g)}},createChild:function(c,b){var d=(this.dataType)?this.dataType.getElementDataType():null;if(d&&!(d instanceof dorado.EntityDataType)){throw new ResourceException("dorado.data.EntityPropertyExpected",property)}var e=new dorado.Entity(c,this.dataTypeRepository,d);if(!b){this.insert(e)}return e},getById:function(b){return this._keyMap[b]},_fillPage:function(g,f,j){g.entityCount=0;if(f==null){return
}if(!(f instanceof Array)){f=[f]}var c,e;var b=this.dataType;if(b){b._disableObserversCounter++}this._disableObserversCounter++;try{var h=this.elementDataType;for(var d=0;d<f.length;d++){if(h!=null){c=h.parse(f[d])}else{c=new dorado.Entity(f[d],(this.dataType)?this.dataType.get("dataTypeRepository"):null)}if(d==0){e=c}g.insert(c);if(c.state!=dorado.Entity.STATE_DELETED){g.entityCount++;this.entityCount++}}if(f.entityCount){this.entityCount=f.entityCount}if(f.pageCount){this.pageCount=f.pageCount}if(j&&e){this.setCurrent(e)}}finally{this._disableObserversCounter--;if(b){b._disableObserversCounter--}}if(e){this.timestamp=dorado.Core.getTimestamp();this.sendMessage(0)}},cancel:function(){var c=this.iterator(this),b;while(c.hasNext()){b=c.next();b.disableObservers();b.cancel();b.enableObservers()}if(b){this.timestamp=dorado.Core.getTimestamp();this.sendMessage(0)}},clear:function(){this._pages=[];this._keyMap={};this.entityCount=0;this.current=null;this.sendMessage(0)},flush:function(e){if(!this.dataProvider){throw new dorado.ResourceException("dorado.data.NoDataPipe")
}this._disableObserversCounter++;try{this.clear()}finally{this._disableObserversCounter--}if(e){var c=this;this.getPage(this.pageNo,true,function(h,g){c._disableObserversCounter++;try{if(h){var f=(g.first)?g.first.data:null;c.setCurrent(f);$callback(e,true,null)}}finally{c._disableObserversCounter--;c.sendMessage(0)}})}else{var d=this.getPage(this.pageNo,true).first;var b=(d)?d.data:null;this._disableObserversCounter++;try{this.setCurrent(b)}finally{this._disableObserversCounter--;this.sendMessage(0)}}},flushAsync:function(b){this.flush(b)},fromJSON:function(c){if(c.pageNo){this.pageNo=c.pageNo}if(this.pageCount==0){if(c.pageCount){this.pageCount=c.pageCount}else{if(this.pageNo==1){this.pageCount=1}}}var b=this.getPage(this.pageNo,true);this._fillPage(b,c,true)},toJSON:function(d,e){var b=[];var h=(d)?d.generateDataType:false;var g=(d)?d.entityFilter:null;var f=this.iterator(d);while(f.hasNext()){var c=f.next();if(c){if(!g||g(c)){b.push(c.toJSON(d,e))}}else{b.push(null)}if(h){d.generateDataType=false
}}if(h){d.generateDataType=true}if(b.length==0&&g){b=null}return b},toArray:function(){var b=[];this.each(function(c){b.push(c)});return b},each:function(d,c){for(var b=1;b<=this.pageCount;b++){if(this.isPageLoaded(b)){this._pages[b].each(d,c)}}},iterator:function(b){return new dorado.EntityList.EntityListIterator(this,b)},toText:function(){return this.toString()},toString:function(){return"[EntityList("+this.entityCount+")]"},clone:function(){var b=new dorado.EntityList(null,this.dataTypeRepository,this.dataType);for(var c=this.iterator();c.hasNext();){b.insert(c.next())}return b}});var a=dorado.EntityList.Page=$extend(dorado.util.KeyedList,{$className:"dorado.EntityList.Page",constructor:function(c,b){$invokeSuper.call(this,[(function(d){return d.entityId})]);this.entityList=c;this.pageNo=b;this.entityCount=c.pageSize},insert:function(d,c,b){$invokeSuper.call(this,arguments);d.page=this;d.parent=this.entityList;d._setObserver(this.entityList._observer);this.entityList._keyMap[d.entityId]=d;
this.loaded=true},remove:function(b){$invokeSuper.call(this,arguments);b.page=null;b.parent=null;b._setObserver(null);delete this.entityList._keyMap[b.entityId]}});dorado.EntityList.EntityListIterator=$extend(dorado.util.Iterator,{$className:"dorado.EntityList.EntityListIterator",constructor:function(c,b){this._entityList=c;if(b===true){this._includeDeletedEntity=true}else{if(b instanceof Object){this._includeDeletedEntity=b.includeDeletedEntity;this._includeUnloadPage=b.includeUnloadPage;this._nextIndex=b.nextIndex;this._fixedPageNo=b.pageNo;if(!this._fixedPageNo&&b.currentPage){this._fixedPageNo=c.pageNo}this._simulateUnloadPage=b.simulateUnloadPage;if(this._simulateUnloadPage){this._includeUnloadPage=true}}}this.firstOrLast()},firstOrLast:function(e){var h=this._entityList;var d=h.pageCount;var c=this._pageNo=(this._fixedPageNo||(e?d:1));this._previous=this._current=this._next=null;this._previousPage=this._currentPage=this._nextPage=c;if(this._nextIndex){var j=0;if(!this._fixedPageNo){while(c>0&&c<=d){var g=h.getPage(c,false);
j+=g.entityCount;if(j>this._nextIndex){j-=g.entityCount;break}e?c--:c++;if(j>=this._nextIndex){break}}}this._next=this._findFromPage(c);if(this._next){this._nextPage=this._next.pageNo;this._current=this._findNeighbor(this._next,this._nextPage,true);if(this._current){this._currentPage=this._current.pageNo;this._previous=this._findNeighbor(this._current,this._currentPage,true);if(this._previous){this._previousPage=this._previous.pageNo}}for(var f=j;f<this._nextIndex;f++){if(this.hasNext()){this.next()}else{break}}}}else{var b=this._findFromPage(c,e);if(e){this._previous=b;if(this._previous){this._previousPage=this._previous.pageNo}}else{this._next=b;if(this._next){this._nextPage=this._next.pageNo}}}},_findFromPage:function(c,e){var b=null,h=this._entityList,d=h.pageCount,f;if(this._includeUnloadPage){f=h.getPage(c,!this._simulateUnloadPage)}else{while(c>0&&c<=d){var g=h.getPage(c,false);if(g.loaded){f=g;break}if(this._fixedPageNo){break}c+=(e?-1:1)}}if(f){if(f.loaded){b=e?f.last:f.first;while(b&&!this._includeDeletedEntity&&b.data.state==dorado.Entity.STATE_DELETED){b=e?b.previous:b.next
}}else{b={data:dorado.Entity.getDummyEntity(c)};this._simulatePageSize=(c==d)?(h.entityCount%h.pageSize):h.pageSize;this._simulateIndex=(e)?this._simulatePageSize:0}}return b},_findNeighbor:function(d,b,c){if(!d){return null}var e=c?-1:1;if(d.data&&!d.data.dummy){do{d=c?d.previous:d.next}while(d&&!this._includeDeletedEntity&&d.data.state==dorado.Entity.STATE_DELETED);if(d){d.pageNo=b}}else{this._simulateIndex+=e;if(this._simulateIndex<0||this._simulateIndex>=this._simulatePageSize){this._simulateIndex-=e;d=null}}if(d==null&&!this._fixedPageNo){b+=e;if(b>0&&b<=this._entityList.pageCount){d=this._findFromPage(b,c)}}return d},_find:function(c){var b=this._findNeighbor((c?this._previous:this._next),(c?this._previousPage:this._nextPage),c);if(c){this._next=this._current;this._nextPage=this._currentPage;this._current=this._previous;this._currentPage=this._previousPage;this._previous=b;this._previousPage=b?b.data.page.pageNo:1}else{this._previous=this._current;this._previousPage=this._currentPage;
this._current=this._next;this._currentPage=this._nextPage;this._next=b;this._nextPage=b?b.data.page.pageNo:this._entityList.pageCount}},first:function(){this.firstOrLast()},last:function(){this.firstOrLast(true)},hasPrevious:function(){return !!this._previous},hasNext:function(){return !!this._next},previous:function(){if(!this._previous){this._next=this._current;this._nextPage=this._currentPage;this._current=this._previous=null;this._currentPage=this._previousPage=1;return null}var b=this._previous.data;this._find(true);return b},next:function(){if(!this._next){this._previous=this._current;this._previousPage=this._currentPage;this._current=this._next=null;this._currentPage=this._nextPage=this._entityList.pageCount;return null}var b=this._next.data;this._find(false);return b},current:function(){return(this._current)?this._current.data:null},createBookmark:function(){return{previous:this._previous,current:this._current,next:this._next,previousPage:this._previousPage,currentPage:this._currentPage,nextPage:this._nextPage,simulateIndex:this._simulateIndex,simulatePageSize:this._simulatePageSize}
},restoreBookmark:function(b){this._previous=b.previous;this._current=b.current;this._next=b.next;this._previousPage=b.previousPage;this._currentPage=b.currentPage;this._nextPage=b.nextPage;this._simulateIndex=b.simulateIndex;this._simulatePageSize=b.simulatePageSize}})}());dorado.validator={};dorado.Toolkits.registerTypeTranslator("validator",function(a){return dorado.util.Common.getClassType("dorado.validator."+a+"Validator",true)});dorado.validator.Validator=$extend(dorado.AttributeSupport,{className:"dorado.Validator",ATTRIBUTES:{defaultResultMessage:{},defaultResultState:{defaultValue:"error"}},constructor:function(a){$invokeSuper.call(this,arguments);if(a){this.set(a)}},validate:function(b){var a=this.doValidate(b);return dorado.Toolkits.trimMessages(a,this._defaultResultState)}});dorado.validator.RemoteValidator=$extend(dorado.validator.Validator,{className:"dorado.validator.RemoteValidator",ATTRIBUTES:{async:{defaultValue:true},executingMessage:{}},validate:function(b,c){if(this._async){this.doValidate(b,{scope:this,callback:function(e,d){if(e){d=dorado.Toolkits.trimMessages(d,this._defaultResultState)
}$callback(e,d)}})}else{var a=$invokeSuper.call(this,arguments);if(c){$callback(c,true,a)}return a}}});dorado.validator.LengthValidator=$extend(dorado.validator.Validator,{className:"dorado.validator.LengthValidator",ATTRIBUTES:{minLength:{defaultValue:-1},maxLength:{defaultValue:-1}},doValidate:function(d){if(typeof d!="string"){return}var c,b="",a=d.length;if(this._minLength>0&&a<this._minLength){c=true;b+=$resource("dorado.data.ErrorContentTooShort",this._minLength)}if(this._maxLength>0&&a>this._maxLength){c=true;if(b){b+="\n"}b+=$resource("dorado.data.ErrorContentTooLong",this._maxLength)}return b}});dorado.validator.RangeValidator=$extend(dorado.validator.Validator,{className:"dorado.validator.RangeValidator",ATTRIBUTES:{minValue:{},minValueValidateMode:{defaultValue:"ignore"},maxValue:{},maxValueValidateMode:{defaultValue:"ignore"}},doValidate:function(d){var c,b="",a="",d=(typeof d=="number")?d:parseFloat(d);if(this._minValueValidateMode!="ignore"){if(d==this._minValue&&this._minValueValidateMode!="allowEquals"){c=true;
a=$resource("dorado.data.ErrorOrEqualTo")}if(d<this._minValue){c=true}if(c){b+=$resource("dorado.data.ErrorNumberTooLess",a,this._minValue)}}if(this._maxValueValidateMode!="ignore"){if(d==this._maxValue&&this._maxValueValidateMode!="allowEquals"){c=true;a=$resource("dorado.data.ErrorOrEqualTo")}if(d>this._maxValue){c=true}if(c){if(b){b+="\n"}b+=$resource("dorado.data.ErrorNumberTooGreat",a,this._maxValue)}}if(c){return b}}});dorado.validator.EnumValidator=$extend(dorado.validator.Validator,{className:"dorado.validator.EnumValidator",ATTRIBUTES:{enumValus:{}},doValidate:function(a){if(this._enumValues instanceof Array&&this._enumValues.indexOf(a)<0){return $resource("dorado.data.ErrorValueOutOfEnumRange")}}});dorado.validator.RegExpValidator=$extend(dorado.validator.Validator,{className:"dorado.validator.RegExpValidator",ATTRIBUTES:{whiteRegExp:{},blackRegExp:{},validateMode:{defaultValue:"whiteBlack"}},doValidate:function(data){function toRegExp(text){var regexp=null;if(text){regexp=(text.charAt(0)=="/")?eval(text):new RegExp(text)
}return regexp}if(typeof data!="string"){return}var whiteRegExp=toRegExp(this._whiteRegExp),blackRegExp=toRegExp(this._blackRegExp);var valid;if(this._validateMode=="whiteBlack"){valid=blackRegExp&&data.match(blackRegExp)||whiteRegExp&&!data.match(whiteRegExp)}else{valid=whiteRegExp&&!data.match(whiteRegExp)||blackRegExp&&data.match(blackRegExp)}if(!valid){return $resource("dorado.data.ErrorBadFormat",data)}}});dorado.validator.AjaxValidator=$extend(dorado.validator.RemoteValidator,{className:"dorado.validator.AjaxValidator",ATTRIBUTES:{service:{}},constructor:function(a){if(!dorado.widget||!dorado.widget.AjaxAction){this._disabled=true;alert("'dorado.validator.AjaxValidator' is disabled because the 'dorado.widget.AjaxAction' is not available.")}$invokeSuper.call(this,arguments)},doValidate:function(c,d){var b=this._ajaxAction;if(!b){this._ajaxAction=b=new dorado.widget.AjaxAction()}b.set({async:this._async,executingMessage:this._executingMessage,service:this._service,parameter:c});var a=b.execute(this._async?d:null);
if(a&&!this._async){return b.get("returnValue")}}});(function(){var BREAK_ALL={};var BREAK_LEVEL={};var ENTITY_PATH_CACHE={};dorado.DataPath=$class({$className:"dorado.DataPath",_ALL:[{visibility:1}],_CURRENT:[{visibility:2}],_REPEAT_ALL:[{visibility:1,repeat:true}],constructor:function(path){this.path=(path!=null)?$.trim(path):path},_throw:function(message,position){var text="DataPath syntax error";if(message){text+=(":\n"+message+"in:\n")}else{text+=" in:\n"}var path=this.path;text+=path;if(isFinite(position)){position=parseInt(position);text+="\nat char "+position}throw new SyntaxError(text)},compile:function(){function isUnsignedInteger(s){return(s.search(/^[0-9]+$/)==0)}var path=this.path;if(path==null||path==""||path=="*"){this._compiledPath=this._ALL;return}if(path=="#"||path=="[#current]"){this._compiledPath=this._CURRENT;this._compiledPath.singleResult=true;return}var _path=path.toLowerCase();if(_path=="(repeat)"||_path=="(r)"){this._compiledPath=this._REPEAT_ALL;return}var compiledPath=[];
var property="";var args=null;var arg;var conditions=null;var condition;var quotation=null;var inArgs=false;var afterArgs=false;var inCondition=false;var afterCondition=false;var escapeNext=false;for(var i=0;i<path.length;i++){var c=path.charAt(i);if(escapeNext){property+=c;escapeNext=false;continue}if(afterArgs&&afterCondition&&c!="."){this._throw(null,i)}switch(c){case".":if(!quotation&&!inArgs&&!inCondition){compiledPath.push({property:property,args:args,conditions:conditions});property="";args=null;arg="";conditions=null;condition="";c=null;quotation=null;inArgs=false;afterArgs=false;inCondition=false;afterCondition=false}break;case",":if(!inArgs&&!inCondition){this._throw(null,i)}if(!quotation){if(inArgs){args.push(arg);arg=""}else{if(inCondition){conditions.push(condition);condition=""}}c=null}break;case"'":case'"':if(!inArgs&&!inCondition){this._throw(null,i)}if(!quotation){quotation=c}else{if(quotation==c){quotation=null}}break;case"[":if(inArgs||afterCondition){this._throw(null,i)
}if(!inCondition){inCondition=true;conditions=[];condition="";c=null}break;case"]":if(inCondition){if(condition.length>0){conditions.push(condition)}inCondition=false;afterCondition=true;c=null}else{this._throw(null,i)}break;case"(":if(!inCondition){if(inArgs||afterArgs){this._throw(null,i)}inArgs=true;args=[];arg="";c=null}break;case")":if(!inCondition&&afterArgs){this._throw(null,i)}if(inArgs){if(arg.length>0){args.push(arg)}inArgs=false;afterArgs=true;c=null}break;case"@":c="$this";break;default:escapeNext=(c=="\\")}if(!escapeNext&&c!=null){if(inCondition){condition+=c}else{if(inArgs){arg+=c}else{property+=c}}}}if(property.length>0||(args&&args.length>0)||(conditions&&conditions.length>0)){compiledPath.push({property:property,args:args,conditions:conditions})}var singleResult=(compiledPath.length>0);for(var i=0;i<compiledPath.length;i++){var section=compiledPath[i];if((!section.property||section.property=="*")&&!section.args&&!section.conditions){section=this._ALL;compiledPath[i]=section;
singleResult=false}else{var property=section.property;if(property){if(property.charAt(0)=="#"){section.visibility=2;section.property=property=property.substring(1)}if(property.charAt(0)=="!"){section.interceptor=property.substring(1)}}var args=section.args;if(args){for(var j=0;j<args.length;j++){var arg=args[j].toLowerCase();if(arg=="r"||arg=="repeat"){section.repeat=true}else{if(arg=="l"||arg=="leaf"){section.repeat=true;section.leaf=true}else{if(isUnsignedInteger(arg)){section.max=parseInt(arg)}}}}}var conditions=section.conditions;if(conditions){for(var j=conditions.length-1;j>=0;j--){var condition=conditions[j];if(condition&&condition.charAt(0)=="#"&&!(section.visibility>0)){if(condition=="#dirty"){section.visibility=3}else{if(condition=="#new"){section.visibility=4}else{if(condition=="#modified"){section.visibility=5}else{if(condition=="#deleted"){section.visibility=6}else{if(condition=="#current"){section.visibility=2}else{this._throw('Unknown token "'+condition+'".')}}}}}conditions.removeAt(j)
}}}singleResult=(section.visibility==2&&(section.leaf||!section.repeat))}}compiledPath.singleResult=singleResult;this._compiledPath=compiledPath},_selectEntityIf:function(context,entity,isLeaf){var section=context.section;if(!section.leaf||isLeaf){var sections=context.sections;if(section==sections[sections.length-1]){context.addResult(entity)}else{this._evaluateSectionOnEntity(context,entity,true)}}},_evaluateSectionOnEntity:function(context,entity,nextSection){var oldLevel=context.level;if(nextSection){if(context.level>=(context.sections.length-1)){reutrn}context.setCurrentLevel(context.level+1)}var oldLastSection=context.lastSection;var section=context.section;context.lastSection=section;try{var result;if(section.interceptor){var interceptors=dorado.DataPath.interceptors[section.interceptor];if(interceptors&&interceptors.dataInterceptor){result=interceptors.dataInterceptor.call(this,entity,section.interceptor)}else{throw new dorado.Exception('DataPath interceptor "'+section.interceptor+'" not found.')
}}else{if(section.property){if(entity instanceof dorado.Entity){dorado.Entity.ALWAYS_RETURN_VALID_ENTITY_LIST=!section.leaf;try{result=entity.get(section.property,context.loadMode)}finally{dorado.Entity.ALWAYS_RETURN_VALID_ENTITY_LIST=true}}else{result=entity[section.property]}if(result==null&&section.leaf&&section==oldLastSection){this._selectEntityIf(context,entity,true)}}else{result=entity}}if(result!=null){if(result instanceof dorado.EntityList||result instanceof Array){this._evaluateSectionOnAggregation(context,result)}else{this._selectEntityIf(context,result);if(section.repeat){this._evaluateSectionOnEntity(context,entity)}}}}finally{context.lastSection=oldLastSection;context.setCurrentLevel(oldLevel)}},_evaluateSectionOnAggregation:function(context,entities,isRoot){function selectEntityIf(entity){var b=true;switch(section.visibility){case 3:b=entity.state!=dorado.Entity.STATE_NONE;break;case 4:b=entity.state==dorado.Entity.STATE_NEW;break;case 5:b=entity.state==dorado.Entity.STATE_MODIFIED;
break;case 6:b=entity.state==dorado.Entity.STATE_DELETED;break}if(b){var conditions=section.conditions;if(conditions){var $this=entity;for(var i=0;i<conditions.length;i++){b=eval(conditions[i]);if(!b){break}}}}if(b){this._selectEntityIf(context,entity)}if(section.repeat){this._evaluateSectionOnEntity(context,entity)}}try{var section=context.section;if(section.interceptor){var interceptors=dorado.DataPath.interceptors[section.interceptor];if(interceptors&&interceptors.dataInterceptor){entities=interceptors.dataInterceptor.call(this,entities,section.interceptor);if(!(entities instanceof dorado.EntityList||entities instanceof Array)){if(entities!=null){entities=[entities]}else{return}}}else{throw new dorado.Exception('DataPath interceptor "'+section.interceptor+'" not found.')}}if(!isRoot&&context.acceptAggregation&&(section.visibility||1)==1){var sections=context.sections;if(section==sections[sections.length-1]){this._selectEntityIf(context,entities,true)}}if(entities instanceof dorado.EntityList){if(section.visibility==2){if(entities.current){selectEntityIf.call(this,entities.current)
}}else{var it=entities.iterator(section.visibility==3||section.visibility==6);while(it.hasNext()){selectEntityIf.call(this,it.next())}}}else{for(var i=0;i<entities.length;i++){selectEntityIf.call(this,entities[i])}}}catch(e){if(e!=BREAK_LEVEL){throw e}}},evaluate:function(data,options){var firstResultOnly,acceptAggregation=false,loadMode;if(options===true){firstResultOnly=options}else{if(options instanceof Object){firstResultOnly=options.firstResultOnly;acceptAggregation=options.acceptAggregation;loadMode=options.loadMode}}loadMode=loadMode||"always";if(this._compiledPath===undefined){this.compile()}firstResultOnly=firstResultOnly||this._compiledPath.singleResult;var context=new dorado.DataPathContext(this._compiledPath,firstResultOnly);context.acceptAggregation=acceptAggregation;context.loadMode=loadMode;try{if(data!=null){if(data instanceof dorado.EntityList||data instanceof Array){this._evaluateSectionOnAggregation(context,data,true)}else{this._evaluateSectionOnEntity(context,data)}}return context.results
}catch(e){if(e==BREAK_ALL){return(firstResultOnly)?context.result:context.results}else{throw e}}},getDataType:function(dataType,options){if(!dataType){return null}var acceptAggregationDataType,loadMode;if(options===true){acceptAggregationDataType=options}else{if(options instanceof Object){acceptAggregationDataType=options.acceptAggregationDataType;loadMode=options.loadMode}}loadMode=loadMode||"always";var cache=dataType._subDataTypeCache;if(cache){var dt=cache[this.path];if(dt!==undefined){if(!acceptAggregationDataType&&dt instanceof dorado.AggregationDataType){dt=dt.getElementDataType(loadMode)}if(dt instanceof dorado.DataType){return dt}}}else{dataType._subDataTypeCache=cache={}}if(dataType instanceof dorado.LazyLoadDataType){dataType=dataType.get(loadMode)}if(this._compiledPath===undefined){this.compile()}var compiledPath=this._compiledPath;for(var i=0;i<compiledPath.length;i++){var section=compiledPath[i];if(section.interceptor){var interceptors=dorado.DataPath.interceptors[section.interceptor];
if(interceptors&&interceptors.dataTypeInterceptor){dataType=interceptors.dataTypeInterceptor.call(this,dataType,section.interceptor)}else{dataType=null}}else{if(section.property){if(dataType instanceof dorado.AggregationDataType){dataType=dataType.getElementDataType(loadMode)}var p=dataType.getPropertyDef(section.property);dataType=(p)?p.get("dataType"):null}}if(!dataType){break}}cache[this.path]=dataType;if(!acceptAggregationDataType&&dataType instanceof dorado.AggregationDataType){dataType=dataType.getElementDataType(loadMode)}return dataType},_section2Path:function(section){var path=(section.visibility==2)?"#":"";path+=(section.property)?section.property:"";var args=section.args;if(args&&args.length>0){path+="("+args.join(",")+")"}var conditions=section.conditions;if(conditions&&conditions.length>0){path+="["+conditions.join(",")+"]"}return(path)?path:"*"},_compiledPath2Path:function(){var compiledPath=this._compiledPath;var sections=[];for(var i=0;i<compiledPath.length;i++){sections.push(this._section2Path(compiledPath[i]))
}return sections.join(".")},toString:function(){this.compile();return this._compiledPath2Path()}});dorado.DataPath.create=function(path){var key=path||"$EMPTY";var dataPath=ENTITY_PATH_CACHE[key];if(dataPath==null){ENTITY_PATH_CACHE[key]=dataPath=new dorado.DataPath(path)}return dataPath};dorado.DataPath.interceptors={};dorado.DataPath.registerInterceptor=function(section,dataInterceptor,dataTypeInterceptor){dorado.DataPath.interceptors[section]={dataInterceptor:dataInterceptor,dataTypeInterceptor:dataTypeInterceptor}};dorado.DataPathContext=$class({$className:"dorado.DataPathContext",constructor:function(sections,firstResultOnly){this.sections=sections;this.firstResultOnly=firstResultOnly;this.level=-1;this.levelInfos=[];if(firstResultOnly){this.result=null}else{this.results=[]}this.lastSection=sections[sections.length-1];this.setCurrentLevel(0)},setCurrentLevel:function(level){if(level>this.level){this.levelInfos[level]=this.levelInfo={count:0}}else{this.levelInfo=this.levelInfos[level]
}this.level=level;this.section=this.sections[level]},addResult:function(result){if(this.firstResultOnly){this.result=result;throw BREAK_ALL}else{var section=this.section;if(section.max>0&&this.levelInfo.count>=section.max){throw BREAK_LEVEL}this.results.push(result);this.levelInfo.count++}}})})();(function(){dorado.DataUtil={extractNameFromId:function(f){function e(h){if(h.indexOf("v:")==0){var g=h.indexOf("$");if(g>0){return h.substring(g+1)}}return h}var c=f;var b=dorado.DataType.getSubName(f);if(b){var d=this.extractNameFromId(b);if(d!=b){c=c.replace(b,d)}}return e(c)},convertIfNecessary:function(d,b,c){if(d==null){return d}if(c){if(c instanceof dorado.LazyLoadDataType){c=c.get()}else{if(typeof c=="string"&&b){c=b.get(c)}}}if(d instanceof dorado.Entity||d instanceof dorado.EntityList){if(!c||d.dataType==c){return d}if(d.dataType instanceof dorado.AggregationDataType&&d.dataType.get("elementDataType")==c){return d}d=d.toJSON()}if(d.$dataType&&!c&&b){c=b.get(d.$dataType)}if(c){if(c instanceof dorado.EntityDataType&&d instanceof Array){c=new dorado.AggregationDataType({elementDataType:c})
}if(c instanceof dorado.DataType){d=c.parse(d)}}return d},convert:function(e,c,d){if(e==null){return e}var b=this.convertIfNecessary(e,c,d);if(b==e){if(e instanceof Array){b=new dorado.EntityList(e,c,d)}else{if(e instanceof Object){b=new dorado.Entity(e,c,d)}else{throw new dorado.ResourceException("dorado.data.DataTypeUnsupported")}}}return b},isOwnerOf:function(c,b){if(c==null){return false}while(true){c=c.parent;if(c==null){return false}if(c==b){return true}}},DEFAULT_SORT_PARAMS:[{desc:false}],sort:function(e,c,b){function d(f,k){function j(s,x,n){if(n){return n(s,x,c)}var r,q;if(!(c instanceof Array)){c=[c]}for(var t=0;t<c.length;t++){var o=c[t],w=o.property;var v,u;if(w){v=(s instanceof dorado.Entity)?s.get(w):s[w];u=(s instanceof dorado.Entity)?x.get(w):x[w]}else{v=s;u=x}if(v>u){return(o.desc)?-1:1}else{if(v<u){return(o.desc)?1:-1}}}return 0}var m=f,g=k;var i=parseInt((f+k)/2);var h=e[i];do{while(j(e[f],h,b)<0){f++}while(j(e[k],h,b)>0){k--}if(f<=k){var l=e[f];e[f]=e[k];e[k]=l;f++;
k--}}while(f<=k);if(k>m){d(m,k)}if(g>f){d(f,g)}}if(c==null&&!b){c=this.DEFAULT_SORT_PARAMS}d(0,e.length-1)}};function a(b,c){return parseFloat((b instanceof dorado.Entity)?b.get(c):b[c])||0}dorado.SummaryCalculators={count:function(d,b,c){return d+1},sum:function(d,b,c){return d+a(b,c)},average:{getInitialValue:function(){return{sum:0,count:0}},accumulate:function(d,b,c){d.sum+=a(b,c);d.count++;return d},getFinalValue:function(b){return b.count?b.sum/b.count:0}},max:{getInitialValue:function(){return null},accumulate:function(e,c,d){var b=a(c,d);return(b<e)?e:b}},min:{getInitialValue:function(){return null},accumulate:function(e,c,d){var b=a(c,d);return(b>e)?e:b}}}})();