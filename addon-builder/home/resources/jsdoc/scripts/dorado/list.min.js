dorado.widget.list={};dorado.widget.AbstractList=$extend(dorado.widget.Control,{$className:"dorado.widget.AbstractList",focusable:true,ATTRIBUTES:{itemModel:{},highlightCurrentRow:{defaultValue:true},allowNoCurrent:{skipRefresh:true},selectionMode:{defaultValue:"none",skipRefresh:true,setter:function(b,a){this.replaceSelection(this.get("selection"),null,true);this._selectionMode=a;this.replaceSelection(this.get("selection"),null)}},selection:{},dragMode:{writeBeforeReady:true,defaultValue:"item"},dropMode:{writeBeforeReady:true,defaultValue:"insertItems"}},EVENTS:{onCurrentChange:{},onSelectionChange:{}},constructor:function(){this._itemModel=this.createItemModel();$invokeSuper.call(this,arguments)},createItemModel:function(){return new dorado.widget.list.ItemModel()},createDom:function(){var a=$invokeSuper.call(this,arguments);if(!dorado.Browser.msie){a.style.overflow="auto"}return a},applyDraggable:function(b,a){if(this._droppable&&b==this._dom&&this._dragMode=="item"){return}$invokeSuper.call(this,arguments)
},initDraggingInfo:function(a,b){$invokeSuper.call(this,arguments);if(this._dragMode!="control"){var c=this.findItemDomByEvent(b);a.set({object:c?$fly(c).data("item"):null,insertMode:null,refObject:null})}},initDraggingIndicator:function(c,a,b){if(this._dragMode!="control"){var e=a.get("element");if(e){var d=$DomUtils.xCreateElement({tagName:"div",className:"d-list-dragging-item"});$fly(e).find(">*").clone().appendTo(d);c.set("content",d)}}}});dorado.widget.ViewPortList=$extend(dorado.widget.AbstractList,{$className:"dorado.widget.ViewPortList",ATTRIBUTES:{scrollMode:{defaultValue:"lazyRender"}},createDom:function(){return this._container=$invokeSuper.call(this,arguments)},refreshItemDoms:function(m,h,j,a){if(!this._itemDomMap){this._itemDomMap={}}var l=this._itemModel.getStartIndex();if(!a&&this._scrollMode=="viewport"&&this.startIndex>=0){var n=h?this.startIndex+this.itemDomCount:this.startIndex;if(Math.abs(l-n)<(this.itemDomCount)/2){for(var f=Math.abs(l-n);f>0;f--){if(l>n){m.appendChild(m.firstChild)
}else{m.insertBefore(m.lastChild,m.firstChild)}}}}var p=0;var e=this._itemModel.iterator();var g=e.createBookmark(),d=false,k=true;if(h){e.next();k=e.hasNext();if(k){e.next()}}this._shouldSkipRender=false;while(h?e.hasPrevious():e.hasNext()){var o=h?e.previous():e.next();var c=this.refreshItemDom(m,o,p,h);p++;if(j&&!j(c)){if(this._scrollMode=="viewport"){d=true;break}else{this._shouldSkipRender=true;j=null}}}this._shouldSkipRender=false;var b=0;if(!d&&this._scrollMode=="viewport"){e.restoreBookmark(g);if(k){h?e.previous():e.next()}while(h?e.hasNext():e.hasPrevious()){var o=h?e.next():e.previous();var c=this.refreshItemDom(m,o,--b,!h);p++;if(j&&!j(c)){break}}}if(!a){for(var f=m.childNodes.length-1;f>=p;f--){this.removeItemDom(h?m.firstChild:m.lastChild)}}this.startIndex=h?l-b-p+1:l+b;this.itemCount=this._itemModel.getItemCount();this.itemDomCount=p;return p},removeItemDom:function(a){if(this._itemDomMap[a.itemId]==a){delete this._itemDomMap[a.itemId]}jQuery(a).remove()},getScrollingIndicator:function(){var a=dorado.widget.ViewPortList._indicator;
if(!a){a=document.createElement("DIV");dorado.widget.ViewPortList._indicator=a;$fly(a).addClass("d-list-scrolling-indicator").hide();document.body.appendChild(a)}$fly(a).bringToFront();return a},setScrollingIndicator:function(b){var a=this.getScrollingIndicator();$fly(a).text(b).show();$DomUtils.placeCenterElement(a,this.getDom())},hideScrollingIndicator:function(){$fly(this.getScrollingIndicator()).hide()},onResize:function(){this.refresh(true)}});(function(){valueComparators={};dorado.widget.list.ItemModel=$class({$className:"dorado.widget.list.ItemModel",EMPTY_ITERATOR:new dorado.util.ArrayIterator([]),_itemDomSize:0,_viewPortSize:0,_scrollSize:0,_scrollPos:0,_startIndex:0,_reverse:false,setItemDomSize:function(a){this._itemDomSize=a},getStartIndex:function(){return this._startIndex},setStartIndex:function(a){this._startIndex=a},isReverse:function(){return this._reverse},setReverse:function(a){this._reverse=a},setScrollSize:function(a,b){this._viewPortSize=a;this._scrollSize=b},setScrollPos:function(c){var b=this.getItemCount();
if(b>0){var a=this._scrollSize/b;if(c/(this._scrollSize-this._viewPortSize)>0.5){this._startIndex=b-1-(Math.round((this._scrollSize-this._viewPortSize-c)/a)||0);if(this._startIndex>b-1){this._startIndex=b-1}this._reverse=true}else{this._startIndex=Math.round(c/a)||0;this._reverse=false}}else{this._startIndex=0;this._reverse=false}},getItems:function(){return this._items},setItems:function(a){this.filter();if(a instanceof dorado.EntityList){this._items=a}else{if(a!=null){this._items=(a instanceof Array)?a:[a]}else{this._items=[]}}},iterator:function(c){var a=this._items;if(!a){return this.EMPTY_ITERATOR}var b=c;if(b==null){b=this._startIndex||0}if(a instanceof Array){return new dorado.util.ArrayIterator(this._items,b)}else{return a.iterator({nextIndex:b})}},getItemCount:function(){var a=this._items;if(!a){return 0}return(a instanceof Array)?a.length:((a.pageSize>0&&a.entityCount>a.pageSize)?a.pageSize:a.entityCount)},getItemAt:function(a){if(!this._items||!(a>=0)){return null}if(this._items instanceof Array){return this._items[a]
}else{var b=this._items;return b.iterator({nextIndex:a}).next()}},getItemById:function(a){if(this._items instanceof Array){return this._items.indexOf(a)}else{return this._items.getById(a)}},getItemIndex:function(c){if(!this._items||!c){return -1}if(this._items instanceof Array){return this._items.indexOf(c)}else{var e=this._items,f=c.entityId,d=c.page;if(d.entityList!=e){return -1}var a=0,b=d.first;while(b!=null){if(b.data.entityId==f){return a}if(b.data.state!=dorado.Entity.STATE_DELETED){a++}b=b.next}return -1}},getItemId:function(b,a){if(this._items instanceof Array||!(b instanceof dorado.Entity)){return(a>=0)?a:this.getItemIndex(b)}else{return b.entityId}},sort:function(c,a){if(!this.getItemCount()){return}var b=this.toArray();dorado.DataUtil.sort(b,c,a);if(!(this._items instanceof Array)){this._items=b}},filter:function(b){function f(j){var i=valueComparators[escape(j)];if(!i){valueComparators[escape(j)]=i=new Function("v1,v2","return v1"+((j=="=")?"==":j)+"v2")}return i}function g(j,i){var k=(j instanceof dorado.Entity)?j.get(i.property):j[i.property];
var l=i.operator;if(!l){l=(typeof k=="string")?"like":"="}if(l=="like"){return(k+"").indexOf(i.value)>=0}else{return f(l)(k,i.value)}}if(b&&b.length>0){if(this._originItems){this._items=this._originItems}else{this._originItems=this._items}var c=[];for(var e=this.iterator(0);e.hasNext();){var a=e.next(),h=true;for(var d=0;d<b.length;d++){if(!g(a,b[d])){h=false;break}}if(h){c.push(a)}}this._items=c}else{if(this._originItems){this._items=this._originItems;delete this._originItems}}},toArray:function(){if(this._items instanceof Array){return this._items}else{if(this._items instanceof dorado.EntityList){return this._items.toArray()}else{var a=[];for(var b=this.iterator(0);b.hasNext();){a.push(b.next())}return a}}}})})();(function(){var TABLE_HEIGHT_ADJUST=(dorado.Browser.msie)?-1:0;dorado.widget.RowList=$extend(dorado.widget.ViewPortList,{$className:"dorado.widget.RowList",ATTRIBUTES:{rowHeight:{defaultValue:18},selection:{setter:function(p,v){if(v==null&&"multiRows"==this._selectionMode){v=[]
}this.replaceSelection(this.get("selection"),v)}}},EVENTS:{onDataRowClick:{}},constructor:function(){$invokeSuper.call(this,arguments);if(this._itemModel){this._itemModel.setItemDomSize(this._rowHeight)}},getIndexByItemId:function(itemId){if(typeof itemId=="number"){return itemId}else{var itemModel=this._itemModel;return itemModel.getItemIndex(itemModel.getItemById(itemId))}},getCurrentItemDom:function(){return this._currentRow},getDraggableOptions:function(dom){var options=$invokeSuper.call(this,arguments);if(dom==this._dom){options.handle=":first-child"}return options},createDataTable:function(){var table=this._dataTable=$DomUtils.xCreateElement({tagName:"TABLE",cellSpacing:0,cellPadding:0,className:"data-table",content:{tagName:"TBODY"}});var tbody=this._dataTBody=table.tBodies[0];var self=this;$fly(table).mouseover(function(evt){if($DomUtils.isDragging()){return}dorado.Toolkits.cancelDelayedAction(self,"$hoverOutTimerId");self.setHoverRow(self.findItemDomByEvent(evt))}).mouseout(function(evt){dorado.Toolkits.setDelayedAction(self,"$hoverOutTimerId",function(){self.setHoverRow(null)
},50)});return table},findItemDomByEvent:function(evt){var target=evt.srcElement||evt.target;var target=target||evt,tbody=this._dataTBody;return $DomUtils.findParent(target,function(parentNode){return parentNode.parentNode==tbody})},onMouseDown:function(evt){var row=this.findItemDomByEvent(evt);if(row||this._allowNoCurrent){var oldCurrentItem=this.getCurrentItem();if(this.setCurrentItemDom(row)){var clickedItem=(row?$fly(row).data("item"):null),selection=this.get("selection");if(this._selectionMode=="singleRow"){this.replaceSelection(null,clickedItem)}else{if(this._selectionMode=="multiRows"){var removed=[],added=[];if(evt.ctrlKey){this.addOrRemoveSelection(selection,clickedItem,removed,added)}else{if(evt.shiftKey){if(oldCurrentItem){var itemModel=this._itemModel;var si=itemModel.getItemIndex(oldCurrentItem);var ei=itemModel.getItemIndex(clickedItem);if(si>ei){var i=si;si=ei,ei=i}var c=ei-si+1,i=0;itemModel.setStartIndex(si);var it=itemModel.iterator(si);while(it.hasNext()&&i<c){var item=it.next();
if(item!=oldCurrentItem){this.addOrRemoveSelection(selection,item,removed,added)}i++}}else{this.addOrRemoveSelection(selection,clickedItem,removed,added)}}else{removed=selection;added.push(clickedItem)}}this.replaceSelection(removed,added)}}}if(dorado.Browser.msie){var tbody=this._dataTBody;try{var cell=$DomUtils.findParent(evt.target,function(parentNode){return parentNode.parentNode.parentNode==tbody},true);if(cell){((cell.firstChild&&cell.firstChild.nodeType==1)?cell.firstChild:cell).focus()}}catch(e){evt.target.focus()}}}return false},setSelection:function(selection){this._selection=selection},replaceSelection:function(removed,added,silence){if(removed==added&&removed!=null){return}var selection=this.get("selection"),selectionMode=this._selectionMode;switch(selectionMode){case"singleRow":removed=selection;if(removed){this.toggleItemSelection(removed,false)}if(added){this.toggleItemSelection(added,true)}this.setSelection(added);break;case"multiRows":if(removed&&selection){if(removed==selection){removed=selection.slice(0);
for(var i=0;i<selection.length;i++){this.toggleItemSelection(selection[i],false)}selection=null}else{for(var i=0;i<removed.length;i++){selection.remove(removed[i]);this.toggleItemSelection(removed[i],false)}}}if(selection==null){this.setSelection(selection=[])}if(added){for(var i=0;i<added.length;i++){selection.push(added[i]);this.toggleItemSelection(added[i],true)}}break}if(!silence){this.fireEvent("onSelectionChange",this,{removed:removed,added:added})}},addOrRemoveSelection:function(selection,clickedObj,removed,added){if(selection.indexOf(clickedObj)<0){added.push(clickedObj)}else{removed.push(clickedObj)}},toggleItemSelection:function(item,selected){if(!this._itemDomMap){return}var row=this._itemDomMap[this._itemModel.getItemId(item)];if(row){$fly(row).toggleClass("selected-row",selected)}},onClick:function(evt){if(this.findItemDomByEvent(evt)){this.fireEvent("onDataRowClick",this,{event:evt})}},setHoverRow:function(row){if(row){if(this._draggable&&this._dragMode!="control"){this.applyDraggable(row)
}$fly(row).addClass("hover-row")}if(this._hoverRow==row){return}if(this._hoverRow){$fly(this._hoverRow).removeClass("hover-row")}this._hoverRow=row},setCurrentRow:function(row){if(this._currentRow==row){return}this.setHoverRow(null);if(this._currentRow){$fly(this._currentRow).removeClass("current-row")}this._currentRow=row;if(row&&this._highlightCurrentRow){$fly(row).addClass("current-row")}},getItemTimestamp:function(item){return(item instanceof dorado.Entity)?item.timestamp:-1},refreshItemDoms:function(tbody,reverse,fn){if(this._scrollMode=="viewport"){this.setCurrentRow(null)}this._duringRefreshAll=true;this._selectionCache=this.get("selection");try{return $invokeSuper.call(this,arguments)}finally{delete this._selectionCache;this._duringRefreshAll=false}},refreshItemDom:function(tbody,item,index,prepend){var row;if(index>=0&&index<tbody.childNodes.length){var i=index;if(prepend){i=tbody.childNodes.length-i-1}row=tbody.childNodes[i];if(this._itemDomMap[row.itemId]==row){delete this._itemDomMap[row.itemId]
}}else{row=this.createItemDom(item);prepend?tbody.insertBefore(row,tbody.firstChild):tbody.appendChild(row)}var flag=prepend?-1:1;if(index<0){flag=-flag}index=this._itemModel.getStartIndex()+index*flag;var itemId=this._itemModel.getItemId(item,index);this._itemDomMap[itemId]=row;row.itemIndex=index;row.itemId=itemId;var $row=$fly(row);$row.data("item",item);$row.toggleClass("odd-row",(!this._itemModel.groups&&(index%2)==1));if(itemId==this.getCurrentItemId()){this.setCurrentRow(row)}if(this._selectionMode!="none"){var selection=this._selectionCache||this.get("selection");switch(this._selectionMode){case"singleRow":$row.toggleClass("selected-row",selection==item);break;case"multiRows":$row.toggleClass("selected-row",selection.indexOf(item)>=0);break}}this.refreshItemDomData(row,item);return row},refreshItemDomData:function(row,item){if(row._lazyRender){return}var timestamp=this.getItemTimestamp(item);if(this._ignoreItemTimestamp||timestamp<=0||row.timestamp!=timestamp){this.doRefreshItemDomData(row,item);
row.timestamp=timestamp}},refreshContent:function(container){if(!this._dataTable){var table=this.createDataTable();container.appendChild(table)}if(this._scrollMode=="viewport"){var beginBlankRow=this._beginBlankRow;var endBlankRow=this._endBlankRow;if(beginBlankRow){beginBlankRow.parentNode.style.display="none"}if(endBlankRow){endBlankRow.parentNode.style.display="none"}this._itemModel.setScrollPos(0)}var fn;if(this._scrollMode=="lazyRender"&&container.clientHeight>0){var count=parseInt(container.clientHeight/this._rowHeight),i=0;fn=function(row){i++;return i<=count}}this.refreshItemDoms(this._dataTBody,false,fn)},refreshViewPortContent:function(container){var beginBlankRow=this._beginBlankRow;var endBlankRow=this._endBlankRow;if(!this._dataTable){container.appendChild(this.createDataTable())}if(!beginBlankRow){this._beginBlankRow=beginBlankRow=$DomUtils.xCreateElement({tagName:"TR",className:"preparing-area",content:"^TD"});var thead=document.createElement("THEAD");thead.appendChild(beginBlankRow);
container.firstChild.appendChild(thead)}if(!endBlankRow){this._endBlankRow=endBlankRow=$DomUtils.xCreateElement({tagName:"TR",className:"preparing-area",content:"^TD"});var tfoot=document.createElement("TFOOT");tfoot.appendChild(endBlankRow);container.firstChild.appendChild(tfoot)}var tbody=this._dataTBody;var itemModel=this._itemModel,itemCount=itemModel.getItemCount();var clientHeight=(container.scrollWidth>container.clientWidth)?container.offsetHeight:container.clientHeight;var viewPortHeight,itemDomCount,self=this;if(clientHeight){viewPortHeight=TABLE_HEIGHT_ADJUST;itemDomCount=this.refreshItemDoms(tbody,itemModel.isReverse(),function(row){viewPortHeight+=row.offsetHeight;if(dorado.Browser.safari){viewPortHeight-=2}return viewPortHeight<=(clientHeight+0)})}else{itemDomCount=viewPortHeight=0}this._itemDomCount=itemDomCount;if(!this._skipProcessBlankRows){var startIndex=this.startIndex;var cols=this._cols||1;var rowHeightAverage=(itemDomCount>0)?viewPortHeight/itemDomCount:this._rowHeight;
with(beginBlankRow){if(startIndex>0){firstChild.colSpan=cols;firstChild.style.height=Math.round(startIndex*rowHeightAverage)+"px";parentNode.style.display=""}else{parentNode.style.display="none";firstChild.style.height="0px"}}with(endBlankRow){if((itemDomCount+startIndex)<itemCount){firstChild.colSpan=cols;firstChild.style.height=Math.round((itemCount-itemDomCount-startIndex)*rowHeightAverage)+"px";parentNode.style.display=""}else{parentNode.style.display="none";firstChild.style.height="0px"}}var st;if(this.startIndex>=itemModel.getStartIndex()){st=this._dataTBody.offsetTop}else{st=this._dataTBody.offsetTop+this._dataTBody.offsetHeight-container.clientHeight}container.scrollTop=this._scrollTop=st;var scrollHeight=container.scrollHeight;itemModel.setScrollSize(container.clientHeight,scrollHeight);this._rowHeightAverage=rowHeightAverage}},_watchScroll:function(){delete this._watchScrollTimerId;if(this._scrollMode=="simple"){return}var container=this._container;if(container.scrollLeft==0&&container.scrollTop==0&&container.offsetWidth>0){container.scrollLeft=this._scrollLeft||0;
container.scrollTop=this._scrollTop||0}if(this._scrollTop){this._watchScrollTimerId=$setTimeout(this,this._watchScroll,300)}},onScroll:function(){if(this._scrollMode=="simple"){return}var container=this._container;if((this._scrollLeft||0)!=container.scrollLeft){if(this.onXScroll){this.onXScroll()}}if((this._scrollTop||0)!=container.scrollTop){this.onYScroll()}if(this._watchScrollTimerId){clearTimeout(this._watchScrollTimerId);delete this._watchScrollTimerId}if(container.scrollTop){this._watchScrollTimerId=$setTimeout(this,this._watchScroll,300)}this._scrollLeft=container.scrollLeft;this._scrollTop=container.scrollTop},onYScroll:function(){var container=this._container;if(container.scrollTop==(container._scrollTop||0)){return}if(this._scrollMode=="viewport"){if(dorado.Toolkits.cancelDelayedAction(container,"$scrollTimerId")){if(Math.abs(container.scrollTop-container._scrollTop)>(container.clientHeight/2)){var itemCount=this._itemModel.getItemCount();var rowHeight=container.scrollHeight/itemCount;
this.setScrollingIndicator((Math.round(container.scrollTop/rowHeight)+1)+"/"+itemCount)}}else{container._scrollTop=container.scrollTop}var self=this;dorado.Toolkits.setDelayedAction(container,"$scrollTimerId",function(){self.doOnYScroll()},300)}else{container._scrollTop=container.scrollTop;this.doOnYScroll()}},doOnYScroll:function(){var container=this._container;if(this._scrollMode=="viewport"){dorado.Toolkits.cancelDelayedAction(container,"$scrollTimerId");this._itemModel.setScrollPos(container.scrollTop);this.setHoverRow(null);this.refresh();this.hideScrollingIndicator()}else{if(this._scrollMode=="lazyRender"){var rows=this._dataTBody.rows;var i=parseInt(container.scrollTop/this._rowHeight)||0;if(i>=rows.length){i=rows.length-1}var row=rows[i];if(!row){return}while(row.offsetTop>container.scrollTop){i--;row=rows[i]}var bottom=container.scrollTop+container.clientHeight;while(row&&row.offsetTop<bottom){if(row._lazyRender){var item=$fly(row).data("item");this.createItemDomDetail(row,item);
delete row._lazyRender;this.refreshItemDomData(row,item)}i++;row=rows[i]}}}},createDom:function(){var dom=$invokeSuper.call(this,arguments);if(dorado.Browser.msie&&dorado.Browser.version>="8"){dom.hideFocus=true}$fly(dom).bind("scroll",$scopify(this,this.onScroll));return dom},refreshDom:function(dom){var dynaHeight=!dom.style.height||!dom.style.width,oldHeight;if(dynaHeight){oldHeight=dom.offsetHeight}$invokeSuper.call(this,arguments);if(this._scrollMode=="viewport"){this.refreshViewPortContent(dom)}else{this.refreshContent(dom)}if(this._currentScrollMode&&this._currentScrollMode!=this._scrollMode&&!this.getCurrentItemId()){this.onYScroll()}this._currentScrollMode=this._scrollMode;if(this._currentRow){this.scrollItemDomIntoView(this._currentRow)}if(dorado.Browser.msie){$DomUtils.fixMsieYScrollBar(dom);if(!this._itemModelFixed&&this._scrollMode=="viewport"){this._itemModel.setScrollSize(dom.clientHeight,dom.scrollHeight)}}if(dynaHeight&&oldHeight!=dom.offsetHeight){this.notifySizeChange()
}delete this._ignoreItemTimestamp},notifySizeChange:function(){if(!this._dom.style.height||!this._dom.style.width){$invokeSuper.call(this,arguments)}},scrollItemDomIntoView:function(row){with(this._container){var st=-1;if((row.offsetTop+row.offsetHeight)>(scrollTop+clientHeight)){st=row.offsetTop+row.offsetHeight-clientHeight}else{if(row.offsetTop<scrollTop){st=row.offsetTop}}if(st>=0){if(this._scrollMode!="lazyRender"){this._scrollTop=st}scrollTop=st}}},scrollCurrentIntoView:function(){var currentItemId=this.getCurrentItemId();if(currentItemId!=null){var row=this._currentRow;if(row){this.scrollItemDomIntoView(row)}else{if(this._scrollMode=="viewport"){var itemModel=this._itemModel;var index=this.getIndexByItemId(currentItemId);if(index<0){index=0}itemModel.setStartIndex(index);var oldReverse=itemModel.isReverse();itemModel.setReverse(index>=this.startIndex);this.refresh();itemModel.setReverse(oldReverse)}}}},findItemDomByPosition:function(pos){var dom=this._dom,y=pos.y+dom.scrollTop,row=null;
var rows=this._dataTBody.rows,rowHeight=this._rowHeightAverage||this._rowHeight,i;if(this._scrollMode=="viewport"){var relativeY=y;if(this._beginBlankRow){relativeY-=this._beginBlankRow.offsetHeight}i=parseInt(relativeY/rowHeight)}else{i=parseInt(y/rowHeight)}if(i<0){i=0}else{if(i>=rows.length){i=rows.length-1}}row=rows[i];while(row){if(row.offsetTop>y){row=row.previousSibling}else{if(row.offsetTop+row.offsetHeight<y){if(row.nextSibling){row=row.nextSibling}else{row._dropY=y-row.offsetTop;break}}else{row._dropY=y-row.offsetTop;break}}}return row},setDraggingOverItemDom:function(itemDom){if(this._draggingOverItemDom==itemDom){return}if(this._draggingOverItemDom){$fly(this._draggingOverItemDom).removeClass("drag-over-row")}this._draggingOverItemDom=itemDom;if(itemDom){$fly(itemDom).addClass("drag-over-row")}},showDraggingInsertIndicator:function(draggingInfo,insertMode,itemDom){var insertIndicator=dorado.widget.RowList.getDraggingInsertIndicator();var $insertIndicator=$fly(insertIndicator);
if(insertMode){var dom=this._dom;var width=dom.offsetWidth;var top=(insertMode=="before")?itemDom.offsetTop:(itemDom.offsetTop+itemDom.offsetHeight);if(dom.clientWidth<width){width=dom.clientWidth}$insertIndicator.width(width).height(2).left(0).top(top-1).show().appendTo(dom)}else{$insertIndicator.hide()}},doOnDraggingSourceMove:function(draggingInfo,evt,targetObject,insertMode,refObject,itemDom){var accept=(draggingInfo.isDropAcceptable(this._droppableTags)&&!(this._dropMode=="onItem"&&targetObject==null));draggingInfo.set({targetObject:targetObject,insertMode:insertMode,refObject:refObject,accept:accept});var eventArg={draggingInfo:draggingInfo,event:evt,processDefault:true};this.fireEvent("onDraggingSourceMove",this,eventArg);if(accept&&eventArg.processDefault){this.showDraggingInsertIndicator(draggingInfo,insertMode,itemDom);this.setDraggingOverItemDom((accept&&!insertMode)?itemDom:null)}return eventArg.processDefault},onDraggingSourceMove:function(draggingInfo,evt){var dropMode=this._dropMode;
var targetObject=draggingInfo.get("targetObject");var insertMode,refObject,itemDom;if(dropMode!="onControl"){var pos=this.getMousePosition(evt);itemDom=this.findItemDomByPosition(pos);if(itemDom&&$fly(itemDom).data("item")==draggingInfo.get("object")){itemDom=null}if(itemDom){if(dropMode=="insertItems"){var dropY=itemDom._dropY;var halfHeight=itemDom.offsetHeight/2;insertMode=(dropY<halfHeight)?"before":"after"}else{if(dropMode=="onOrInsertItems"){var dropY=itemDom._dropY;if(dropY<=4){insertMode="before"}else{if((itemDom.offsetHeight-dropY)<=4){insertMode="after"}}}}}refObject=itemDom?$fly(itemDom).data("item"):null;if(!refObject){targetObject=(dropMode=="onAnyWhere")?this:null}else{targetObject=refObject}}return this.doOnDraggingSourceMove(draggingInfo,evt,targetObject,insertMode,refObject,itemDom)},onDraggingSourceOut:function(draggingInfo,evt){$invokeSuper.call(this,arguments);this.setDraggingOverItemDom();this.showDraggingInsertIndicator()},processItemDrop:function(draggingInfo,evt){function getItemList(control,entity){var list;
if(entity instanceof dorado.Entity){list=entity.parent}else{if(control.ATTRIBUTES.itemModel){var itemModel=control.get("itemModel");if(itemModel){list=itemModel.getItems()}}}return list}var object=draggingInfo.get("object");var insertMode=draggingInfo.get("insertMode");var refObject=draggingInfo.get("refObject");var sourceControl=draggingInfo.get("sourceControl");if(insertMode&&refObject||this._dropMode=="insertItems"||this._dropMode=="onOrInsertItems"||this._dropMode=="onAnyWhere"){var sourceList=getItemList(sourceControl,object);if(sourceList){sourceList.remove(object);if(!dorado.Object.isInstanceOf(sourceControl,dorado.widget.DataControl)){sourceControl.refresh()}}var targetList=this.get("itemModel").getItems(),highlight;if(!targetList&&!dorado.Object.isInstanceOf(this,dorado.widget.DataControl)&&this.ATTRIBUTES.items){targetList=[];this.set("items",targetList)}if(targetList){if(targetList instanceof dorado.EntityList){targetList.insert(object,insertMode,refObject);highlight=object}else{var i=refObject?targetList.indexOf(refObject):-1;
if(i<0){targetList.push(object);highlight=targetList.length-1}else{if(insertMode=="after"){i++}targetList.insert(object,i);highlight=i}}if(!dorado.Object.isInstanceOf(this,dorado.widget.DataControl)){this.refresh()}if(highlight!=null){this.highlightItem(highlight)}return true}}return false},onDraggingSourceDrop:function(draggingInfo,evt){var dropped=$invokeSuper.call(this,arguments);if(!dropped){dropped=this.processItemDrop(draggingInfo,evt)}return dropped}});dorado.widget.RowList.getDraggingInsertIndicator=function(){var indicator=this._draggingInsertIndicator;if(indicator==null){indicator=$DomUtils.xCreateElement({tagName:"div",className:"d-list-dragging-insert-indicator"});this._draggingInsertIndicator=indicator}return indicator}})();dorado.widget.list.ListBoxRowRenderer=$extend(dorado.Renderer,{$className:"dorado.ListBoxRowRenderer",render:function(d,a){var b=a.data,c="";if(b){if(a.property){if(b instanceof dorado.Entity){c=b.getText(a.property)}else{c=b[a.property]}}else{c=b}}d.innerText=c
}});dorado.widget.AbstractListBox=$extend(dorado.widget.RowList,{$className:"dorado.widget.AbstractListBox",ATTRIBUTES:{className:{defaultValue:"d-list-box"},width:{defaultValue:200},property:{},renderer:{}},EVENTS:{onRenderRow:{}},doRefreshItemDomData:function(c,b){var d=true,a={dom:c.firstChild,data:b,property:this._property,processDefault:false};if(this.getListenerCount("onRenderRow")){this.fireEvent("onRenderRow",this,a);d=a.processDefault}if(d){(this._renderer||$singleton(dorado.widget.list.ListBoxRowRenderer)).render(c.firstChild,a)}},createItemDom:function(a){var b=document.createElement("TR");b.className="row";b.style.height=this._rowHeight+"px";if(this._scrollMode=="lazyRender"&&this._shouldSkipRender){b._lazyRender=true;b.style.height=this._rowHeight+"px"}else{this.createItemDomDetail(b,a)}return b},createItemDomDetail:function(c,b){var a=document.createElement("TD");c.appendChild(a)},getItemByEvent:function(a){var b=this.findItemDomByEvent(a);return(b)?$fly(b).data("item"):null
}});dorado.widget.ListBox=$extend(dorado.widget.AbstractListBox,{$className:"dorado.widget.ListBox",ATTRIBUTES:{currentIndex:{skipRefresh:true,defaultValue:-1,setter:function(b,a){if(a>=this._itemModel.getItemCount()){a=-1}if(this._currentIndex==a){return}this._currentIndex=a;var c=this.getItemDomByItemIndex(a);this.setCurrentRow(c);if(c){this.scrollCurrentIntoView()}this.fireEvent("onCurrentChange",this)}},currentItem:{readOnly:true,getter:function(){return this.getCurrentItem()}},items:{setter:function(b,a){this._currentIndex=-1;this._itemModel.setItems(a);this.set("selection",null)},getter:function(){return this._itemModel.getItems()}}},refreshDom:function(a){this.set("currentIndex",this._currentIndex);$invokeSuper.call(this,arguments)},getItemDomByItemIndex:function(a){var b=this._itemModel,d;if(a>=b.getItemCount()){a=-1}var c=a>=0?b.getItemAt(a):null;if(this._rendered&&this._itemDomMap&&a>=0){if(this._rowCache&&$fly(this._rowCache).data("item")==c){d=this._rowCache;delete this._rowCache
}else{d=this._itemDomMap[b.getItemId(c)]}}return d},getCurrentItem:function(){if(this._currentIndex>=0){return this._itemModel.getItemAt(this._currentIndex)}},getCurrentItemId:function(){return this._currentIndex},doOnKeyDown:function(a){var b=true;switch(a.keyCode||a.which){case 36:this.set("currentIndex",0);break;case 35:this.set("currentIndex",this._itemModel.getItemCount()-1);break;case 38:if(this._currentIndex>0){this.set("currentIndex",this._currentIndex-1)}b=false;break;case 40:if(this._currentIndex<this._itemModel.getItemCount()-1){this.set("currentIndex",this._currentIndex+1)}b=false;break}return b},setCurrentItemDom:function(a){this._rowCache=a;this.set("currentIndex",a?this._itemModel.getItemIndex($fly(a).data("item")):-1);return true},highlightItem:function(b,a,c){var d=this.getItemDomByItemIndex(b);if(d){$fly(d).addClass("highlighting-row").effect("highlight",a||{color:"#FF8000"},c||1500,function(){$fly(d).removeClass("highlighting-row")})}}});dorado.widget.DataListBox=$extend([dorado.widget.AbstractListBox,dorado.widget.DataControl],{$className:"dorado.widget.DataListBox",getCurrentItem:function(){if(this._duringRefreshAll){return this._itemModel.getItems().current
}else{return(this._currentRow)?$fly(this._currentRow).data("item"):null}},getCurrentItemId:function(b,a){var c=this.getCurrentItem();return c?c.entityId:null},setCurrentItemDom:function(b){var a=(b?$fly(b).data("item"):null);if(a&&this.setCurrentEntity(a)){this._itemModel.getItems().setCurrent(a);return true}return false},refreshEntity:function(a){var b=this._itemDomMap[a.entityId];if(b){this.refreshItemDomData(b,a)}},refreshDom:function(c){var a=this.getBindingData({firstResultOnly:true,acceptAggregation:true});if(a&&!(a instanceof dorado.EntityList)){throw new dorado.ResourceException(dorado.list.BindingTypeMismatch)}var b=this._itemModel.getItems();if(b!=a){this._itemModel.setItems(a);this.set("selection",null)}$invokeSuper.call(this,arguments)},setCurrentEntity:function(a){var c=a?a.entityId:null;var b=this._itemDomMap[c];this.setCurrentRow(b);this.scrollCurrentIntoView();this.fireEvent("onCurrentChange",this);return true},doOnKeyDown:function(a){var c=true;var b=this._itemModel.getItems();
switch(a.keyCode){case 36:b.first();break;case 35:b.last();break;case 38:b.previous();c=false;break;case 40:b.next();c=false;break}return c},_adjustBeginBlankRow:function(){this._ignoreOnScroll++;var c=this._itemModel;var a=this.getDom();var d=this._beginBlankRow;var b=a.scrollTop-d.offsetHeight;d.firstChild.style.height=this.startIndex*this._rowHeightAverage+"px";a.scrollTop=d.offsetHeight+b;c.setScrollSize(a.clientHeight,a.scrollHeight);$setTimeout(this,function(){this._ignoreOnScroll--},0)},_adjustEndBlankRow:function(){var b=this._itemModel;var a=this.getDom();var c=this._endBlankRow;c.firstChild.style.height=(b.getItemCount()-this.startIndex-this.itemDomCount)*this._rowHeightAverage+"px";b.setScrollSize(a.clientHeight,a.scrollHeight)},onEntityDeleted:function(a){var b=a.entity;var g=this._itemDomMap[b.entityId],c=this._dataTBody;if(this._scrollMode!="viewport"){if(g){var f=g.nextSibling;this.removeItemDom(g);if(this._forceRefreshRearRows){this._ignoreItemTimestamp=true;while(f){this.refreshItemDom(c,$fly(f).data("item"),f.sectionRowIndex);
f=f.nextSibling}}this.notifySizeChange()}}else{var e=this._itemModel;if(this._forceRefreshRearRows){if(this._forceRefreshRearRows){this._ignoreItemTimestamp=true}this.refresh(true)}else{if(g){if(g==c.firstChild){e.setStartIndex(e.getStartIndex()-1);if(e.getStartIndex()<0){e.setStartIndex(0)}}else{this.removeItemDom(g)}this.refresh(true)}else{var d=e.getItemIndex(b);if(d>=0){if(d<e.getStartIndex()){this.startIndex--;e.setStartIndex(e.getStartIndex()-1);this._adjustBeginBlankRow()}else{this._adjustEndBlankRow()}}}}}},onEntityInserted:function(j){var b=j.entity;var e=j.insertMode;var a=j.refEntity;var d=this._dataTBody;if(this._scrollMode!="viewport"){var k=this.createItemDom(b);switch(e){case"begin":d.insertBefore(k,d.firstChild);break;case"before":var f=this._itemDomMap[a.entityId];d.insertBefore(k,f);break;case"after":var f=this._itemDomMap[a.entityId];if(f.nextSibling){d.insertBefore(k,f.nextSibling);break}default:d.appendChild(k)}this.refreshItemDom(d,b,k.sectionRowIndex);if(this._forceRefreshRearRows){this._ignoreItemTimestamp=true;
k=k.nextSibling;while(k){this.refreshItemDom(d,$fly(k).data("item"),k.sectionRowIndex);k=k.nextSibling}}this.notifySizeChange()}else{var h=this._itemModel;var c=h.getItemIndex(b);if(c>=0){if(this._forceRefreshRearRows){if(this._forceRefreshRearRows){this._ignoreItemTimestamp=true}this.refresh(true)}else{if(c<this.startIndex){this.startIndex++;h.setStartIndex(h.getStartIndex()+1);this._adjustBeginBlankRow()}else{if(c>=this.startIndex){if(c<this.startIndex+this.itemDomCount){var k=d.lastChild;var g=d.childNodes[c-this.startIndex];d.insertBefore(k,g);this.refresh(true)}else{this._adjustEndBlankRow()}}}}}}},filterDataSetMessage:function(d,a){var c=this._itemModel;var b=c.getItems();switch(d){case dorado.widget.DataSet.MESSAGE_REFRESH:return true;case dorado.widget.DataSet.MESSAGE_CURRENT_CHANGED:return(a.entityList==b||dorado.DataUtil.isOwnerOf(b,a.entityList));case dorado.widget.DataSet.MESSAGE_DATA_CHANGED:case dorado.widget.DataSet.MESSAGE_REFRESH_ENTITY:return(!b||b._observer!=this._dataSet||a.entity.parent==b||dorado.DataUtil.isOwnerOf(b,a.entity));
case dorado.widget.DataSet.MESSAGE_DELETED:return(a.entity.parent==b||dorado.DataUtil.isOwnerOf(b,a.entity));case dorado.widget.DataSet.MESSAGE_INSERTED:return(a.entityList==b);case dorado.widget.DataSet.MESSAGE_ENTITY_STATE_CHANGED:return(a.entity.parent==b);default:return false}},processDataSetMessage:function(d,a,e){switch(d){case dorado.widget.DataSet.MESSAGE_REFRESH:this.refresh(true);break;case dorado.widget.DataSet.MESSAGE_CURRENT_CHANGED:if(a.entityList==this._itemModel.getItems()){var b=this.getCurrentItem();if(!b||b.page.pageNo!=a.entityList.pageNo){this.refresh(true)}else{this.setCurrentEntity(a.entityList.current)}}else{this.refresh(true)}break;case dorado.widget.DataSet.MESSAGE_DATA_CHANGED:case dorado.widget.DataSet.MESSAGE_REFRESH_ENTITY:var c=this._itemModel.getItems();if(!c||c._observer!=this._dataSet){this.refresh(true)}else{this.refreshEntity(a.entity)}break;case dorado.widget.DataSet.MESSAGE_ENTITY_STATE_CHANGED:this.refreshEntity(a.entity);break;case dorado.widget.DataSet.MESSAGE_DELETED:this.onEntityDeleted(a);
break;case dorado.widget.DataSet.MESSAGE_INSERTED:this.onEntityInserted(a);break}},highlightItem:function(a,b,c){var d=this._itemDomMap[a.entityId];if(d){$fly(d).addClass("highlighting-row").effect("highlight",b||{color:"#FF8000"},c||1500,function(){$fly(d).removeClass("highlighting-row")})}}});