<?xml version="1.0" encoding="UTF-8"?>
<project name="build" default="build">
	<property file="build.properties" />

	<property name="dist" value="${workspaceDir}/client/bin" />
	<property name="clientSrc"
	          value="${workspaceDir}/client/client,${workspaceDir}/chart/client,${workspaceDir}/desktop/client,${workspaceDir}/htmleditor/client" />

	<taskdef resource="net/sf/antcontrib/antlib.xml"
	         classpath="lib/ant-contrib-1.0b3.jar" />
	<taskdef resource="com/bstek/dorado/addonbuilder/task.properties"
	         classpath="lib/dorado-addon-builder.jar" />

	<target name="doMergeClientSource">
		<echo message="Merge Client Source: ${src} --> ${dist}" />
		<if>
			<available file="${src}" />
			<then>
				<if>
					<available file="${src}/build-client.xml" />
					<then>
						<echo message="Custom Client Build File: ${src}/build-client.xml" />
						<ant antfile="${src}/build-client.xml"
						     inheritRefs="false">
							<property name="src" value="${src}" />
							<property name="dist" value="${dist}" />
						</ant>
					</then>
					<else>
						<copy todir="${dist}">
							<fileset dir="${src}" excludes="*.xml" />
						</copy>
					</else>
				</if>

				<delete file="${dist}/skins/**/all.*" />
			</then>
		</if>
	</target>

	<target name="mergeClientSource">
		<foreach list="${clientSrc}" param="src" target="doMergeClientSource" />
	</target>

	<target name="buildI18N">
		<makeAddonBuilderHome />
		<taskdef resource="com/bstek/dorado/taskdefs/task.properties">
			<classpath>
				<pathelement path="${addonBuilder.homeDir}/lib/dorado-ant-tasks.jar" />
				<pathelement path="${addonBuilder.homeDir}/lib/js.jar" />
				<pathelement path="${addonBuilder.homeDir}/lib/commons-lang-2.5.jar" />
			</classpath>
		</taskdef>

		<mkdir dir="${dist}/resources/i18n" />
		<buildI18NResource inputDir="${dist}/resources/i18n"
		                   outputDir="${dist}/resources/i18n" />
	</target>

	<target name="build" depends="mergeClientSource,buildI18N" />
</project>
