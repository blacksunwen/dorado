<?xml version="1.0" encoding="UTF-8"?>
<project xmlns:ivy="antlib:org.apache.ivy.ant" name="wrapper" default="build">
	<property file="${basedir}/_build.properties" />

	<property name="work.dir" value="${basedir}/work" />
	<property name="target.dir" value="${basedir}/target" />
	<property name="target.lib.dir" value="${target.dir}/lib" />
	<property name="target.src.dir" value="${target.dir}/src" />
	<property name="target.pom.dir" value="${target.dir}/pom" />

	<property name="lib.dir" value="${basedir}/lib" />
	<property name="resources.dir" value="${basedir}/resources" />

	<property name="ivy.jar" value="ivy-${ivy.version}.jar" />
	<property name="ivy.home" value="${workspace.dir}/ivy" />
	<property name="ivy.cache" value="${ivy.home}/.cache" />
	<property name="ivy.repository" value="${ivy.home}/repository" />
	<available property="ivy.installed" file="${lib.dir}/${ivy.jar}" />

	<property name="oro.jar" value="oro-${oro.version}.jar" />

	<taskdef resource="net/sf/antcontrib/antlib.xml">
		<classpath>
			<pathelement location="${lib.dir}/ant-contrib-1.0b3.jar" />
		</classpath>
	</taskdef>

	<target name="do-resolve-env-libs" unless="ivy.installed">
		<mkdir dir="${ivy.repository}" />
		<get src="http://repo1.maven.org/maven2/oro/oro/${oro.version}/${oro.jar}" dest="${lib.dir}/${oro.jar}" />
		<get src="http://repo1.maven.org/maven2/org/apache/ivy/ivy/${ivy.version}/${ivy.jar}" dest="${lib.dir}/${ivy.jar}" />
	</target>

	<target name="resolve-env-libs" unless="dont-resolve-env-libs">
		<antcall target="do-resolve-env-libs" inheritAll="true" />
	</target>

	<target name="invoke-sub-ant">
		<ant antfile="${basedir}/includes/${build-file}" inheritRefs="true" />
	</target>

	<target name="build" depends="resolve-env-libs">
		<if>
			<equals arg1="${product.qualifier}" arg2="RELEASE" />
			<then>
				<property name="product.revision" value="${product.version}" />
			</then>
			<else>
				<property name="product.revision" value="${product.version}-${product.qualifier}" />
			</else>
		</if>

		<tstamp>
			<format property="product.publication" pattern="yyMMdd.HHmm" locale="true" />
		</tstamp>
		<property name="product.fullversion" value="${product.revision}.${product.publication}" />

		<foreach list="${build-files}" param="build-file" target="invoke-sub-ant" inheritall="true" />
	</target>
</project>
