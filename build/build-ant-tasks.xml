<?xml version="1.0" encoding="UTF-8"?>
<project xmlns:ivy="antlib:org.apache.ivy.ant"
         xmlns:artifact="antlib:org.apache.maven.artifact.ant"
         default="build">
	<property file="build.properties" />

	<taskdef resource="net/sf/antcontrib/antlib.xml"
	         classpath="lib/ant-contrib-1.0b3.jar" />
	<taskdef resource="org/apache/ivy/ant/antlib.xml"
	         uri="antlib:org.apache.ivy.ant"
	         classpath="lib/ivy-2.2.0.jar" />

	<property name="projectDir" value="${workspaceDir}/addon-builder" />
	<property name="workDir" value="${rootWorkDir}/ant-tasks" />
	<property name="targetDir" value="${projectDir}/home/lib" />

	<target name="init">
		<delete dir="${workDir}" />

		<mkdir dir="${workDir}" />
		<mkdir dir="${workDir}/lib" />
		<mkdir dir="${workDir}/src" />
		<mkdir dir="${workDir}/bin" />
	</target>

	<target name="resolveDependencies">
		<ivy:configure file="${workspaceDir}/ivy/ivysettings.xml" />
		<ivy:resolve file="${projectDir}/ivy.xml" />
		<ivy:retrieve pattern="${workDir}/lib/${ivy.fileNamePattern}"
		              conf="compile" />
	</target>

	<target name="compile" depends="resolveDependencies">
		<copy todir="${workDir}/src">
			<fileset dir="${projectDir}/tasks" />
		</copy>

		<javac srcdir="${workDir}/src"
		       destdir="${workDir}/bin"
		       debug="true"
		       deprecation="true"
		       nowarn="false"
		       includeantruntime="true"
		       target="1.5"
		       encoding="utf-8">
			<classpath>
				<fileset dir="${workDir}/lib" includes="*.jar" />
			</classpath>
		</javac>
	</target>

	<target name="jar">
		<jar compress="true" jarfile="${targetDir}/dorado-ant-tasks.jar">
			<fileset dir="${workDir}/bin" />
			<fileset dir="${workDir}/src" excludes="**/*.java" />
		</jar>
	</target>

	<target name="build" depends="init,compile,jar" />
</project>